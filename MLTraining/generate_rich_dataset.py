#!/usr/bin/env python3
"""
Генерує розширений датасет з ключовими словами та їх варіаціями
"""

import csv
import random

# Шаблони фраз для варіацій
EXPENSE_TEMPLATES = [
    "Купив {item}",
    "Оплатив {item}",
    "Витратив на {item}",
    "Заплатив за {item}",
    "{item}",
    "Покупка {item}",
    "Придбав {item}",
    "Замовив {item}",
    "Взяв {item}",
]

INCOME_TEMPLATES = [
    "Отримав {item}",
    "{item}",
    "Надійшла {item}",
    "Прийшла {item}",
    "Виплата {item}",
    "Отримав гроші {item}",
]

# Expense категорії з ключовими словами
EXPENSE_KEYWORDS = {
    "Їжа": [
        "продукти в АТБ",
        "продукти в Сільпо",
        "продукти в Novus",
        "продукти в магазині",
        "продукти в супермаркеті",
        "хліб і молоко",
        "хліб",
        "молоко",
        "м'ясо",
        "м'ясо в магазині",
        "овочі",
        "овочі на ринку",
        "фрукти",
        "фрукти в супермаркеті",
        "їжу в АТБ",
        "їжу в магазині",
        "піцу в Dominos",
        "піцу",
        "суші",
        "їжу в McDonald's",
        "їжу в KFC",
        "доставку їжі",
        "їжу на виніс",
        "обід",
        "обід в ресторані",
        "вечерю",
        "сніданок",
        "каву в Starbucks",
        "каву",
        "бургер",
        "сендвіч",
        "салат",
        "їжу в кафе",
        "їжу в ресторані",
    ],

    "Здоров'я": [
        "ліки в аптеці",
        "ліки",
        "таблетки",
        "таблетки від головного болю",
        "медикаменти",
        "вітаміни",
        "візит до лікаря",
        "прийом у лікаря",
        "консультацію лікаря",
        "візит до стоматолога",
        "стоматолога",
        "аналізи",
        "аналізи в лабораторії",
        "обстеження",
        "медичний огляд",
        "абонемент в спортзал",
        "фітнес",
        "пластир та бинт",
        "термометр",
        "маску медичну",
        "медичні послуги",
    ],

    "Комунальні": [
        "комунальні платежі",
        "світло",
        "електроенергію",
        "газ",
        "воду",
        "воду і водовідведення",
        "інтернет Київстар",
        "інтернет",
        "телефон",
        "мобільний зв'язок",
        "квартплату",
        "опалення",
        "комунальні послуги",
        "фільтр для води",
        "лампочки",
        "інтернет Vodafone",
        "підписку Netflix",
        "підписку Spotify",
    ],

    "Освіта": [
        "курс англійської",
        "курс англійської мови",
        "онлайн курс Udemy",
        "онлайн курс",
        "курси",
        "навчання",
        "книги",
        "книгу",
        "підручники",
        "підручники для університету",
        "підручник",
        "навчальні матеріали",
        "семінар",
        "конференцію",
        "майстер-клас",
        "репетитора з математики",
        "репетитора",
        "курси програмування",
        "сертифікат курсу",
        "зошити та ручки",
        "навчання в університеті",
        "оплату за навчання",
    ],

    "Покупки": [
        "одяг",
        "одяг в H&M",
        "одяг в Zara",
        "взуття",
        "кросівки Nike",
        "кросівки Adidas",
        "кросівки",
        "джинси Levi's",
        "джинси",
        "куртку",
        "футболку",
        "телефон Samsung",
        "телефон",
        "смартфон",
        "ноутбук MacBook",
        "ноутбук",
        "навушники AirPods",
        "навушники",
        "годинник",
        "годинник Apple Watch",
        "планшет iPad",
        "планшет",
        "сумку",
        "рюкзак",
        "окуляри",
        "парфуми",
        "косметику",
        "шампунь",
        "товари в магазині",
        "речі",
        "сорочку",
        "шорти",
        "светр",
    ],

    "Розваги": [
        "білет в кіно",
        "квиток в кіно",
        "білет на концерт",
        "квиток на концерт",
        "гру в Steam",
        "гру",
        "PlayStation Plus",
        "Xbox Game Pass",
        "підписку на гру",
        "ігри",
        "книгу художню",
        "розваги",
        "відпочинок",
        "парк розваг",
        "театр",
        "виставку",
        "музей",
        "Netflix підписку",
        "Spotify Premium",
        "підписку на розваги",
        "квиток на футбол",
        "спортивну подію",
    ],

    "Транспорт": [
        "проїзд в метро",
        "квиток на автобус",
        "квиток на потяг",
        "проїзний",
        "таксі Uber",
        "таксі Bolt",
        "таксі",
        "поїздку на таксі",
        "бензин",
        "бензин на заправці",
        "заправку авто",
        "паркування",
        "парковку",
        "транспорт",
        "ремонт автомобіля",
        "СТО",
        "мийку авто",
        "техогляд",
        "страховку авто",
        "поїздку",
        "проїзд",
        "білет на літак",
        "квиток на поїзд",
    ],

    "Подарунок": [
        "подарунок на день народження",
        "подарунок другу",
        "подарунок",
        "подарунок на свято",
        "подарунок на Новий Рік",
        "квіти",
        "букет квітів",
        "сувенір",
        "подарунок мамі",
        "подарунок тату",
        "подарунок колезі",
        "подарунковий сертифікат",
    ],

    "Інше": [
        "різне",
        "різні покупки",
        "дрібні витрати",
        "непередбачені витрати",
        "інші витрати",
        "витрати на побут",
        "господарські товари",
        "інструменти",
        "батарейки",
        "дрібниці",
    ],
}

# Income категорії з ключовими словами
INCOME_KEYWORDS = {
    "Зарплата": [
        "зарплату",
        "зарплатню",
        "оклад",
        "премію",
        "бонус від роботодавця",
        "бонус",
        "заробітну плату",
        "виплату зарплати",
        "аванс",
        "зарплату за січень",
        "зарплату за місяць",
        "місячну зарплату",
    ],

    "Фріланс": [
        "гроші за проект",
        "оплату за проект",
        "фріланс",
        "замовлення",
        "оплату за розробку",
        "оплату за програмування",
        "гроші за iOS розробку",
        "оплату за додаток",
        "гроші за фріланс",
        "оплату від клієнта",
        "виплату за роботу",
        "гонорар",
    ],

    "Інвестиції": [
        "дивіденди",
        "прибуток з інвестицій",
        "прибуток від акцій",
        "дохід від депозиту",
        "відсотки з депозиту",
        "дохід від криптовалюти",
        "прибуток",
        "інвестиційний дохід",
        "пасивний дохід",
    ],

    "Подарунок": [
        "подарунок на день народження",
        "грошовий подарунок",
        "гроші в подарунок",
        "подарунок від батьків",
        "подарунок від друга",
        "подарунок на свято",
        "подарунок на Новий Рік",
        "гроші від бабусі",
    ],

    "Бонус": [
        "бонус",
        "бонус від роботодавця",
        "додатковий дохід",
        "підробіток",
        "тимчасову роботу",
        "разову виплату",
        "додаткову виплату",
        "винагороду",
        "компенсацію",
    ],

    "Інше джерело": [
        "інший дохід",
        "додатковий заробіток",
        "повернення боргу",
        "повернення грошей",
        "кешбек",
        "знайшов гроші",
        "виграш",
        "компенсацію витрат",
    ],
}

def generate_variations(templates, keywords, transaction_type):
    """Генерує варіації фраз для кожної категорії"""
    result = []

    for category, keyword_list in keywords.items():
        for keyword in keyword_list:
            # Додаємо оригінальний ключ (без шаблону)
            result.append({
                'text': f"{transaction_type}: {keyword}",
                'label': category
            })

            # Додаємо варіації з шаблонів
            for template in templates[:3]:  # Беремо перші 3 шаблони для різноманітності
                variation = template.format(item=keyword)
                result.append({
                    'text': f"{transaction_type}: {variation}",
                    'label': category
                })

    return result

# Генеруємо всі дані
print("🚀 Генерація розширеного датасету...")

expense_data = generate_variations(EXPENSE_TEMPLATES, EXPENSE_KEYWORDS, "expense")
income_data = generate_variations(INCOME_TEMPLATES, INCOME_KEYWORDS, "income")

all_data = expense_data + income_data

# Перемішуємо для кращого навчання
random.shuffle(all_data)

# Записуємо в CSV
output_file = 'transaction_training_data_rich.csv'
with open(output_file, 'w', encoding='utf-8', newline='') as f:
    writer = csv.DictWriter(f, fieldnames=['text', 'label'])
    writer.writeheader()
    writer.writerows(all_data)

print(f"✅ Створено {output_file}")
print(f"   Всього прикладів: {len(all_data)}")
print(f"   Витрат (expense): {len(expense_data)}")
print(f"   Доходів (income): {len(income_data)}")

# Підрахунок по категоріях
category_count = {}
for row in all_data:
    label = row['label']
    category_count[label] = category_count.get(label, 0) + 1

print("\n📊 Розподіл по категоріях:")
for cat, count in sorted(category_count.items(), key=lambda x: -x[1]):
    print(f"   • {cat}: {count}")
