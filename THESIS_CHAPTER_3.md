# –†–û–ó–î–Ü–õ 3. –†–û–ó–†–û–ë–ö–ê –¢–ê –î–û–°–õ–Ü–î–ñ–ï–ù–ù–Ø –ú–û–î–ï–õ–ï–ô –ú–ê–®–ò–ù–ù–û–ì–û –ù–ê–í–ß–ê–ù–ù–Ø –ó–ê–°–û–ë–ê–ú–ò APPLE CREATE ML –¢–ê CORE ML

## 3.1 –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π

### 3.1.1 –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

–î–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –±—É–ª–æ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π Python-—Å–∫—Ä–∏–ø—Ç `generate_rich_dataset.py`, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î –ø—Ä–æ—Ü–µ—Å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–π —Ç–∞ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –∑–±–∏—Ä–∞–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–∏—Ö —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —â–æ —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç—É:**

–ö–æ–∂–µ–Ω –∑–∞–ø–∏—Å —É –Ω–∞–≤—á–∞–ª—å–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—ñ –º—ñ—Å—Ç–∏—Ç—å:
- **text** ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–∏–π –æ–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —É —Ñ–æ—Ä–º–∞—Ç—ñ "—Ç–∏–ø: –æ–ø–∏—Å" (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "expense: –ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë", "income: –ó–∞—Ä–ø–ª–∞—Ç–∞")
- **label** ‚Äî —Ü—ñ–ª—å–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

**–†–æ–∑–º—ñ—Ä –¥–∞—Ç–∞—Å–µ—Ç—É:**
- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∏–∫–ª–∞–¥—ñ–≤: **1,046 –∑–∞–ø–∏—Å—ñ–≤** (1,047 —Ä—è–¥–∫—ñ–≤ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º)
- –†–æ–∑–ø–æ–¥—ñ–ª: ~820 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –≤–∏—Ç—Ä–∞—Ç (expense) —Ç–∞ ~226 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –¥–æ—Ö–æ–¥—ñ–≤ (income)

**–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤–∏—Ç—Ä–∞—Ç (8 –∫–∞—Ç–µ–≥–æ—Ä—ñ–π):**

1. **–á–∂–∞** ‚Äî –ø—Ä–æ–¥—É–∫—Ç–∏ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è, —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∏, –∫–∞—Ñ–µ, –¥–æ—Å—Ç–∞–≤–∫–∞ —ó–∂—ñ
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: –ê–¢–ë, –°—ñ–ª—å–ø–æ, McDonald's, –ø—ñ—Ü–∞, —Å—É—à—ñ, –ø—Ä–æ–¥—É–∫—Ç–∏, –æ–±—ñ–¥

2. **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç** ‚Äî –ø—Ä–æ—ó–∑–¥, —Ç–∞–∫—Å—ñ, –ø–∞–ª–∏–≤–æ, –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—è
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: –º–µ—Ç—Ä–æ, Uber, Bolt, –±–µ–Ω–∑–∏–Ω, –ø–∞—Ä–∫—É–≤–∞–Ω–Ω—è, –°–¢–û

3. **–ü–æ–∫—É–ø–∫–∏** ‚Äî –æ–¥—è–≥, –µ–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞, –ø–æ–±—É—Ç–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: H&M, Zara, Nike, Samsung, MacBook, —Ç–µ–ª–µ—Ñ–æ–Ω, –≤–∑—É—Ç—Ç—è

4. **–ó–¥–æ—Ä–æ–≤'—è** ‚Äî –º–µ–¥–∏—á–Ω—ñ –ø–æ—Å–ª—É–≥–∏, –ª—ñ–∫–∏, —Ñ—ñ—Ç–Ω–µ—Å
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: –∞–ø—Ç–µ–∫–∞, –ª—ñ–∫–∞—Ä, —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥, –∞–Ω–∞–ª—ñ–∑–∏, —Å–ø–æ—Ä—Ç–∑–∞–ª, –≤—ñ—Ç–∞–º—ñ–Ω–∏

5. **–†–æ–∑–≤–∞–≥–∏** ‚Äî –¥–æ–∑–≤—ñ–ª–ª—è, —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç, –∫—É–ª—å—Ç—É—Ä–Ω—ñ –∑–∞—Ö–æ–¥–∏
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: –∫—ñ–Ω–æ, –∫–æ–Ω—Ü–µ—Ä—Ç, Steam, Netflix, PlayStation, —Ç–µ–∞—Ç—Ä

6. **–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–ª—É–≥–∏** ‚Äî –∫–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–ª–∞—Ç–µ–∂—ñ, –∑–≤'—è–∑–æ–∫, –ø—ñ–¥–ø–∏—Å–∫–∏
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: —Å–≤—ñ—Ç–ª–æ, –≥–∞–∑, –≤–æ–¥–∞, —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç, –ö–∏—ó–≤—Å—Ç–∞—Ä, Spotify

7. **–û—Å–≤—ñ—Ç–∞** ‚Äî –Ω–∞–≤—á–∞–Ω–Ω—è, –∫—É—Ä—Å–∏, –∫–Ω–∏–≥–∏, –æ—Å–≤—ñ—Ç–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç, Udemy, –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞, –∫—É—Ä—Å–∏, –∫–Ω–∏–≥–∏, —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä

8. **–Ü–Ω—à–µ** ‚Äî —Ä—ñ–∑–Ω—ñ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏
   - –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞: —Ä—ñ–∑–Ω–µ, –≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫—ñ —Ç–æ–≤–∞—Ä–∏, –¥—Ä—ñ–±–Ω–∏—Ü—ñ

**–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–æ—Ö–æ–¥—ñ–≤ (5 –∫–∞—Ç–µ–≥–æ—Ä—ñ–π):**

1. **–ó–∞—Ä–ø–ª–∞—Ç–∞** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –∑–∞—Ä–æ–±—ñ—Ç–æ–∫, –ø—Ä–µ–º—ñ—ó, –±–æ–Ω—É—Å–∏ –≤—ñ–¥ —Ä–æ–±–æ—Ç–æ–¥–∞–≤—Ü—è
2. **–§—Ä—ñ–ª–∞–Ω—Å** ‚Äî –ø—Ä–æ–µ–∫—Ç–Ω–∞ —Ä–æ–±–æ—Ç–∞, –≥–æ–Ω–æ—Ä–∞—Ä–∏, —Ñ—Ä—ñ–ª–∞–Ω—Å-–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. **–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó** ‚Äî –¥–∏–≤—ñ–¥–µ–Ω–¥–∏, –≤—ñ–¥—Å–æ—Ç–∫–∏ –∑ –¥–µ–ø–æ–∑–∏—Ç—É, –ø—Ä–∏–±—É—Ç–æ–∫ –≤—ñ–¥ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∏
4. **–ü–æ–¥–∞—Ä—É–Ω–æ–∫** ‚Äî –≥—Ä–æ—à–æ–≤—ñ –ø–æ–¥–∞—Ä—É–Ω–∫–∏ –≤—ñ–¥ —Ä–æ–¥–∏—á—ñ–≤ —Ç–∞ –¥—Ä—É–∑—ñ–≤
5. **–ë–æ–Ω—É—Å** ‚Äî –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –¥–æ—Ö—ñ–¥, –ø—ñ–¥—Ä–æ–±—ñ—Ç–æ–∫, –∫–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—ó

**–ú–µ—Ç–æ–¥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó:**

–°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —à–∞–±–ª–æ–Ω–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∞—Ä—ñ–∞—Ü—ñ–π:

```python
EXPENSE_TEMPLATES = [
    "–ö—É–ø–∏–≤ {item}",
    "–û–ø–ª–∞—Ç–∏–≤ {item}",
    "–í–∏—Ç—Ä–∞—Ç–∏–≤ –Ω–∞ {item}",
    "–ó–∞–ø–ª–∞—Ç–∏–≤ –∑–∞ {item}",
    "{item}",
    # ... —ñ–Ω—à—ñ —à–∞–±–ª–æ–Ω–∏
]
```

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è:
- –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞: "expense: –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë"
- 3 –≤–∞—Ä—ñ–∞—Ü—ñ—ó –∑ —Ä—ñ–∑–Ω–∏–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏: "expense: –ö—É–ø–∏–≤ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë", "expense: –û–ø–ª–∞—Ç–∏–≤ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë", —Ç–æ—â–æ

–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω—å —Ç–∞ —Ä–æ–±–∏—Ç—å –º–æ–¥–µ–ª—å —Å—Ç—ñ–π–∫–æ—é –¥–æ —Ä—ñ–∑–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ –æ–ø–∏—Å—É –æ–¥–Ω—ñ—î—ó –π —Ç—ñ—î—ó –∂ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

**–í–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω–∞ —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞ –≤–∏–±—ñ—Ä–∫–∏:**

–ü—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–∞—Ç–∞—Å–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º—ñ—à—É—î—Ç—å—Å—è (`random.shuffle`) –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–∞—Ç–µ–≥–æ—Ä—ñ–π. Create ML –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥—ñ–ª—è—î 20% –¥–∞–Ω–∏—Ö –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó (–ø—Ä–∏–±–ª–∏–∑–Ω–æ 209 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤). –î–æ–¥–∞—Ç–∫–æ–≤–æ –±—É–ª–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—É –≤–∏–±—ñ—Ä–∫—É –∑ 27 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –¥–ª—è —Ä—É—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —è–∫–æ—Å—Ç—ñ –º–æ–¥–µ–ª—ñ.

**–ü–µ—Ä–µ–≤–∞–≥–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É:**

- –ü–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å ‚Äî –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –¥–∞–Ω—ñ
- –ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω—ñ—Å—Ç—å ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
- –†–æ–∑—à–∏—Ä—é–≤–∞–Ω—ñ—Å—Ç—å ‚Äî –ª–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
- –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Äî –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏ –º–∞–≥–∞–∑–∏–Ω—ñ–≤ —Ç–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤

### 3.1.2 –ê–≥—Ä–µ–≥–∞—Ü—ñ—è —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç

–î–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–æ—ó –º–æ–¥–µ–ª—ñ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –±—É–ª–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–ª–∞—Å `ExpenseDataAggregator`, —è–∫–∏–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ —á–∞—Å–æ–≤—ñ —Ä—è–¥–∏, –ø—Ä–∏–¥–∞—Ç–Ω—ñ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è.

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—É ExpenseDataAggregator:**

```swift
final class ExpenseDataAggregator {
    private let transactionRepository: TransactionRepository
    private let categoryRepository: CategoryRepository

    func aggregateMonthlyExpenses() -> Result<[MonthlyExpenseData], CoreDataError>
    func exportToCSV() -> Result<URL, Error>
    func getMonthsOfDataCount() -> Int
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö MonthlyExpenseData:**

–ö–æ–∂–µ–Ω –∑–∞–ø–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –æ–¥–Ω—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑–∞ –æ–¥–∏–Ω –º—ñ—Å—è—Ü—å:

```swift
struct MonthlyExpenseData {
    let year: Int              // –†—ñ–∫ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 2025)
    let month: Int             // –ú—ñ—Å—è—Ü—å (1-12)
    let categoryName: String   // –ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    let totalAmount: Double    // –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∑–∞ –º—ñ—Å—è—Ü—å
    let averageLastThreeMonths: Double  // –ö–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –∑–∞ 3 –º—ñ—Å—è—Ü—ñ
    let season: Int            // –°–µ–∑–æ–Ω —Ä–æ–∫—É (1-4)
}
```

**–í—Ö—ñ–¥–Ω—ñ –æ–∑–Ω–∞–∫–∏ –¥–ª—è ML –º–æ–¥–µ–ª—ñ:**

1. **year** (Int64) ‚Äî —Ä—ñ–∫ –ø—Ä–æ–≥–Ω–æ–∑—É
   - –î–æ–∑–≤–æ–ª—è—î –º–æ–¥–µ–ª—ñ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –¥–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ç—Ä–µ–Ω–¥–∏ —Ç–∞ —ñ–Ω—Ñ–ª—è—Ü—ñ—é

2. **month** (Int64) ‚Äî –º—ñ—Å—è—Ü—å –ø—Ä–æ–≥–Ω–æ–∑—É (1-12)
   - –ú–æ–¥–µ–ª—é—î –º—ñ—Å—è—á–Ω—É —Å–µ–∑–æ–Ω–Ω—ñ—Å—Ç—å –≤–∏—Ç—Ä–∞—Ç

3. **category** (String) ‚Äî –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏—Ç—Ä–∞—Ç
   - –ö–æ–∂–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –≤–∏—Ç—Ä–∞—Ç

4. **averageLastThreeMonths** (Double) ‚Äî —Å–µ—Ä–µ–¥–Ω—è —Å—É–º–∞ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 3 –º—ñ—Å—è—Ü—ñ
   - –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ –æ–∑–Ω–∞–∫–∞ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è
   - –í—Ä–∞—Ö–æ–≤—É—î –Ω–µ—â–æ–¥–∞–≤–Ω—ñ –∑–º—ñ–Ω–∏ –≤ –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

5. **season** (Int64) ‚Äî —Å–µ–∑–æ–Ω —Ä–æ–∫—É
   - 1 = –ó–∏–º–∞ (–≥—Ä—É–¥–µ–Ω—å, —Å—ñ—á–µ–Ω—å, –ª—é—Ç–∏–π)
   - 2 = –í–µ—Å–Ω–∞ (–±–µ—Ä–µ–∑–µ–Ω—å, –∫–≤—ñ—Ç–µ–Ω—å, —Ç—Ä–∞–≤–µ–Ω—å)
   - 3 = –õ—ñ—Ç–æ (—á–µ—Ä–≤–µ–Ω—å, –ª–∏–ø–µ–Ω—å, —Å–µ—Ä–ø–µ–Ω—å)
   - 4 = –û—Å—ñ–Ω—å (–≤–µ—Ä–µ—Å–µ–Ω—å, –∂–æ–≤—Ç–µ–Ω—å, –ª–∏—Å—Ç–æ–ø–∞–¥)

**–¶—ñ–ª—å–æ–≤–∞ –∑–º—ñ–Ω–Ω–∞:**

- **totalAmount** (Double) ‚Äî –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∑–∞ –º—ñ—Å—è—Ü—å —É –≥—Ä–∏–≤–Ω—è—Ö

**–ú–µ—Ç–æ–¥–∏–∫–∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ:**

–ö–æ–≤–∑–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –∑–∞ 3 –º—ñ—Å—è—Ü—ñ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –æ–∫—Ä–µ–º–æ:

```swift
private func calculateAverageLastThreeMonths(
    categoryName: String,
    currentYear: Int,
    currentMonth: Int,
    monthlyData: [String: [String: Double]]
) -> Double {
    var amounts: [Double] = []

    // –ë–µ—Ä–µ–º–æ 3 –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º—ñ—Å—è—Ü—ñ (–Ω–µ –≤–∫–ª—é—á–∞—é—á–∏ –ø–æ—Ç–æ—á–Ω–∏–π)
    for i in 1...3 {
        var targetMonth = currentMonth - i
        var targetYear = currentYear

        // –ö–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—î–º–æ –ø–µ—Ä–µ—Ö—ñ–¥ —á–µ—Ä–µ–∑ –º–µ–∂—É —Ä–æ–∫—É
        if targetMonth <= 0 {
            targetMonth += 12
            targetYear -= 1
        }

        let monthKey = "\(targetYear)-\(String(format: "%02d", targetMonth))"

        if let amount = monthlyData[monthKey]?[categoryName] {
            amounts.append(amount)
        }
    }

    guard !amounts.isEmpty else { return 0.0 }
    return amounts.reduce(0, +) / Double(amounts.count)
}
```

**–°–µ–∑–æ–Ω–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è:**

–°–µ–∑–æ–Ω–∏ –∫–æ–¥—É—é—Ç—å—Å—è —è–∫ —Ü—ñ–ª—ñ —á–∏—Å–ª–∞ –≤—ñ–¥ 1 –¥–æ 4:

```swift
private func getSeason(month: Int) -> Int {
    switch month {
    case 12, 1, 2: return 1  // –ó–∏–º–∞
    case 3, 4, 5: return 2   // –í–µ—Å–Ω–∞
    case 6, 7, 8: return 3   // –õ—ñ—Ç–æ
    case 9, 10, 11: return 4 // –û—Å—ñ–Ω—å
    default: return 1
    }
}
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–µ–ª—ñ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ü–∏–∫–ª—ñ—á–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –≤–∏—Ç—Ä–∞—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –æ–ø–∞–ª–µ–Ω–Ω—è –≤–∑–∏–º–∫—É –∞–±–æ –Ω–∞ –≤—ñ–¥–ø—É—Å—Ç–∫–∏ –≤–ª—ñ—Ç–∫—É).

**–ü—Ä–æ—Ü–µ—Å –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó:**

1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑ –ª–æ–∫–∞–ª—å–Ω–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (Core Data)
2. –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –≤–∏—Ç—Ä–∞—Ç (type == "expense")
3. –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –º—ñ—Å—è—Ü—è—Ö (year-month) —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
4. –°—É–º—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –¥–ª—è –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏
5. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ–≤–∑–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞ 3 –º—ñ—Å—è—Ü—ñ
6. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å–µ–∑–æ–Ω—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
7. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ MonthlyExpenseData

**–í–∏–º–æ–≥–∏ –¥–æ –¥–∞–Ω–∏—Ö:**

- **–ú—ñ–Ω—ñ–º—É–º 3 –º—ñ—Å—è—Ü—ñ** —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ML –º–æ–¥–µ–ª—ñ
- –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑ 1-2 –º—ñ—Å—è—Ü—è–º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è fallback –∞–ª–≥–æ—Ä–∏—Ç–º (–ø—Ä–æ—Å—Ç–µ —Å–µ—Ä–µ–¥–Ω—î)
- –Ø–∫—â–æ –Ω–µ–º–∞—î –∂–æ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó ‚Äî –ø—Ä–æ–≥–Ω–æ–∑ –Ω–µ –Ω–∞–¥–∞—î—Ç—å—Å—è

**–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:**

–ú–µ—Ç–æ–¥ `exportToCSV()` –¥–æ–∑–≤–æ–ª—è—î –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ CSV –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π:

```csv
year,month,category,averageLastThreeMonths,season,totalAmount
2025,1,–á–∂–∞,5000.0,1,5200.0
2025,1,–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç,1500.0,1,1600.0
...
```

### 3.1.3 –ê–Ω–∞–ª—ñ–∑ —è–∫–æ—Å—Ç—ñ —Ç–∞ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–ª–∞—Å—ñ–≤ —É –¥–∞—Ç–∞—Å–µ—Ç—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:**

–ê–Ω–∞–ª—ñ–∑ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É –ø–æ–∫–∞–∑–∞–≤ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª:

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ | –ß–∞—Å—Ç–∫–∞ |
|-----------|-------------------|---------|
| –á–∂–∞ | 272 | 26.0% |
| –ü–æ–∫—É–ø–∫–∏ | 296 | 28.3% |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | 92 | 8.8% |
| –ó–¥–æ—Ä–æ–≤'—è | 88 | 8.4% |
| –†–æ–∑–≤–∞–≥–∏ | 76 | 7.3% |
| –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ | 72 | 6.9% |
| –û—Å–≤—ñ—Ç–∞ | 84 | 8.0% |
| –ü–æ–¥–∞—Ä—É–Ω–æ–∫ | 48 | 4.6% |
| –Ü–Ω—à–µ | 40 | 3.8% |

–†–æ–∑–ø–æ–¥—ñ–ª —î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–º, –∑ –¥–µ—â–æ –±—ñ–ª—å—à–æ—é –≤–∞–≥–æ—é –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π (–á–∂–∞, –ü–æ–∫—É–ø–∫–∏), —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª—É –≤–∏—Ç—Ä–∞—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

**–ê–Ω–∞–ª—ñ–∑ –ø–æ–≤–Ω–æ—Ç–∏ —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö:**

–ö–ª–∞—Å `ExpenseDataAggregator` –º—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–æ–¥–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç–∞—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö:

```swift
func hasEnoughDataForForecasting() -> Bool {
    let uniqueMonths = Set(data.map { $0.monthKey })
    return uniqueMonths.count >= 3
}

func getMonthsOfDataCount() -> Int {
    let uniqueMonths = Set(data.map { $0.monthKey })
    return uniqueMonths.count
}
```

–¶—ñ –º–µ—Ç–æ–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è:
- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è, —á–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ML –º–æ–¥–µ–ª—å –∞–±–æ fallback –∞–ª–≥–æ—Ä–∏—Ç–º
- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
- –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –Ω–∏–∑—å–∫—É —Ç–æ—á–Ω—ñ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤

**–û–±—Ä–æ–±–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å:**

–î–ª—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å –∫–æ–≤–∑–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ (–∫–æ–ª–∏ –Ω–µ–º–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö 3 –º—ñ—Å—è—Ü—ñ–≤):

```swift
guard !amounts.isEmpty else { return 0.0 }
return amounts.reduce(0, +) / Double(amounts.count)
```

–Ø–∫—â–æ —î —Ö–æ—á–∞ –± 1 –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º—ñ—Å—è—Ü—å ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å–µ—Ä–µ–¥–Ω—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å.

**–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –æ–ø–∏—Å—ñ–≤:**

–£ —Å–µ—Ä–≤—ñ—Å—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –±–∞–∑–æ–≤–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è:

```swift
func predictCategory(for description: String, type: String) -> String? {
    guard !description.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty else {
        return nil
    }

    let typedText = "\(type): \(description)"
    // ...
}
```

 

**–ü–µ—Ä–µ–≤–∞–≥–∏ —è–∫—ñ—Å–Ω–æ—ó –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–∏—Ö:**

1. –ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –ø–æ–∫—Ä–∞—â—É—î accuracy –Ω–∞ —Ä—ñ–¥–∫–∏—Ö –∫–ª–∞—Å–∞—Ö
2. –†—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω—å —Ä–æ–±–∏—Ç—å –º–æ–¥–µ–ª—å —Å—Ç—ñ–π–∫–æ—é
3. –°–∏–Ω—Ç–µ—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
4. –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –æ–∑–Ω–∞–∫–∏ –¥–ª—è —Ä–µ–≥—Ä–µ—Å—ñ—ó –ø–æ–ª–µ–≥—à—É—é—Ç—å –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
5. –ú–µ—Ç–æ–¥–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤

---

## 3.

2 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Create ML

### 3.2.1 –ú–æ–¥–µ–ª—å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (TransactionCategoryClassifier)

**–¢–∏–ø –º–æ–¥–µ–ª—ñ:** Text Classifier (MLTextClassifier)

**–§—Ä–µ–π–º–≤–æ—Ä–∫:** CreateML API (Swift)

**–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ:**

–ú–æ–¥–µ–ª—å –Ω–∞–≤—á–∞—î—Ç—å—Å—è –Ω–∞ CSV —Ñ–∞–π–ª—ñ `transaction_training_data_rich.csv` –∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:
- **text** ‚Äî —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç —É –≤–∏–≥–ª—è–¥—ñ "—Ç–∏–ø: –æ–ø–∏—Å" (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "expense: McDonald's", "income: –ó–∞—Ä–ø–ª–∞—Ç–∞")
- **label** ‚Äî —Ü—ñ–ª—å–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–á–∂–∞", "–ó–∞—Ä–ø–ª–∞—Ç–∞")

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª—ñ:**

Apple Create ML –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—ñ–¥—Ö—ñ–¥ **Transfer Learning** –Ω–∞ –±–∞–∑—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–æ—ó –º–æ–≤–Ω–æ—ó –º–æ–¥–µ–ª—ñ. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑:

1. **Word Embedding Layer** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ª—ñ–≤ —É –≤–µ–∫—Ç–æ—Ä–Ω—ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
2. **Feature Extraction** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –≤–∞–∂–ª–∏–≤–∏—Ö –æ–∑–Ω–∞–∫ –∑ —Ç–µ–∫—Å—Ç—É
3. **Maximum Entropy Classifier** ‚Äî –∫—ñ–Ω—Ü–µ–≤–∏–π –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–∏–π —à–∞—Ä

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:**

Swift-—Å–∫—Ä–∏–ø—Ç `train_rich.swift` –≤–∏–∫–æ–Ω—É—î –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª –Ω–∞–≤—á–∞–Ω–Ω—è:

```swift
import Foundation
import CreateML
import TabularData

let csvPath = URL(fileURLWithPath: "\(currentDirectory)/transaction_training_data_rich.csv")
let dataFrame = try DataFrame(contentsOfCSVFile: csvPath)

let classifier = try MLTextClassifier(
    trainingData: dataFrame,
    textColumn: "text",
    labelColumn: "label"
)

let modelPath = URL(fileURLWithPath: "\(currentDirectory)/TransactionCategoryClassifier.mlmodel")
try classifier.write(to: modelPath)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:**

- **–ê–ª–≥–æ—Ä–∏—Ç–º:** Maximum Entropy Classifier (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ—ó –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó)
- **Validation split:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª 80/20 (80% ‚Äî –Ω–∞–≤—á–∞–Ω–Ω—è, 20% ‚Äî –≤–∞–ª—ñ–¥–∞—Ü—ñ—è)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ—Ç–µ—Ä–∞—Ü—ñ–π:** Dynamic (convergence-based) ‚Äî —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –¥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä–≥–µ–Ω—Ü—ñ—ó
- **Feature engineering:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ç–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—è —Ç–∞ n-gram –∞–Ω–∞–ª—ñ–∑
- **Language model:** –ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å Apple –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø—Ä–∏—Ä–æ–¥–Ω–æ—ó –º–æ–≤–∏

**–§–æ—Ä–º–∞—Ç –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö:**

–ö–ª—é—á–æ–≤–æ—é –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—é —î –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑ –æ–ø–∏—Å–æ–º:

```
"expense: –ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë" ‚Üí –á–∂–∞
"income: –ó–∞—Ä–ø–ª–∞—Ç–∞" ‚Üí –ó–∞—Ä–ø–ª–∞—Ç–∞
"expense: –¢–∞–∫—Å—ñ Uber" ‚Üí –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–µ–ª—ñ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü—ñ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–µ—è–∫—ñ —Å–ª–æ–≤–∞ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —Ä—ñ–∑–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –≤–∏—Ç—Ä–∞—Ç —ñ –¥–æ—Ö–æ–¥—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–ø–æ–¥–∞—Ä—É–Ω–æ–∫" –º–æ–∂–µ –±—É—Ç–∏ —è–∫ –≤–∏—Ç—Ä–∞—Ç–æ—é, —Ç–∞–∫ —ñ –¥–æ—Ö–æ–¥–æ–º).

**–ü—Ä–æ—Ü–µ—Å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:**

1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV —á–µ—Ä–µ–∑ `DataFrame(contentsOfCSVFile:)`
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ç–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É
3. –ü–æ–±—É–¥–æ–≤–∞ —Å–ª–æ–≤–Ω–∏–∫–∞ —Ç–∞ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
4. –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è Maximum Entropy –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞
5. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ 20% –¥–∞–Ω–∏—Ö
6. –ï–∫—Å–ø–æ—Ä—Ç —É —Ñ–æ—Ä–º–∞—Ç .mlmodel

**–†–æ–∑–º—ñ—Ä –º–æ–¥–µ–ª—ñ:**

–§—ñ–Ω–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞–π–º–∞—î **7.3 KB** –Ω–∞ –¥–∏—Å–∫—É, —â–æ —Ä–æ–±–∏—Ç—å —ó—ó –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—é –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≤ –º–æ–±—ñ–ª—å–Ω–∏–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫.

### 3.2.2 –ú–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç (ExpenseForecastModel)

**–¢–∏–ø –º–æ–¥–µ–ª—ñ:** Regressor (MLRegressor)

**–§—Ä–µ–π–º–≤–æ—Ä–∫:** CreateML API (Swift)

**–í—Ö—ñ–¥–Ω—ñ –æ–∑–Ω–∞–∫–∏:**

–ú–æ–¥–µ–ª—å –ø—Ä–∏–π–º–∞—î 5 –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

1. **year** (Int64) ‚Äî —Ä—ñ–∫ –ø—Ä–æ–≥–Ω–æ–∑—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 2025)
2. **month** (Int64) ‚Äî –º—ñ—Å—è—Ü—å –ø—Ä–æ–≥–Ω–æ–∑—É –≤—ñ–¥ 1 –¥–æ 12
3. **category** (String) ‚Äî –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏—Ç—Ä–∞—Ç ("–á–∂–∞", "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", —Ç–æ—â–æ)
4. **averageLastThreeMonths** (Double) ‚Äî —Å–µ—Ä–µ–¥–Ω—è —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ 3 –º—ñ—Å—è—Ü—ñ
5. **season** (Int64) ‚Äî —Å–µ–∑–æ–Ω —Ä–æ–∫—É (1 = –ó–∏–º–∞, 2 = –í–µ—Å–Ω–∞, 3 = –õ—ñ—Ç–æ, 4 = –û—Å—ñ–Ω—å)

**–¶—ñ–ª—å–æ–≤–∞ –∑–º—ñ–Ω–Ω–∞:**

- **totalAmount** (Double) ‚Äî –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∑–∞ –º—ñ—Å—è—Ü—å —É –≥—Ä–∏–≤–Ω—è—Ö

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

Create ML –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–∏—Ä–∞—î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–∑–º—ñ—Ä—É —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–∞—Ç–∞—Å–µ—Ç—É:

- **Boosted Tree Regressor** ‚Äî –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤ –∑ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö (>100 –∑–∞–ø–∏—Å—ñ–≤)
  - Ensemble –º–µ—Ç–æ–¥, —â–æ –∫–æ–º–±—ñ–Ω—É—î –¥–µ–∫—ñ–ª—å–∫–∞ decision trees
  - –í–∏—Å–æ–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–∞ –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö

- **Linear Regression** ‚Äî –¥–ª—è –º–∞–ª–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤ (<100 –∑–∞–ø–∏—Å—ñ–≤)
  - –ü—Ä–æ—Å—Ç—ñ—à–∞ –º–æ–¥–µ–ª—å –∑ –º–µ–Ω—à–æ—é –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–Ω–∞–≤—á–∞–Ω–Ω—è
  - –®–≤–∏–¥–∫–µ –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å

**–í–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è:**

Create ML –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **K-fold cross-validation** (—Ç–∏–ø–æ–≤–æ K=5):
- –î–∞—Ç–∞—Å–µ—Ç –¥—ñ–ª–∏—Ç—å—Å—è –Ω–∞ K —á–∞—Å—Ç–∏–Ω
- –ö–æ–∂–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –ø–æ —á–µ—Ä–∑—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
- –§—ñ–Ω–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ —É—Å–µ—Ä–µ–¥–Ω—é—é—Ç—å—Å—è –ø–æ –≤—Å—ñ—Ö fold'–∞—Ö
- –ó–º–µ–Ω—à—É—î —Ä–∏–∑–∏–∫ –ø–µ—Ä–µ–Ω–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –º–∞–ª–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –æ–±—Ä–æ–±–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–æ—ó –æ–∑–Ω–∞–∫–∏:**

–û–∑–Ω–∞–∫–∞ `category` (String) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–¥—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ **One-Hot Encoding**:

```
"–á–∂–∞" ‚Üí [1, 0, 0, 0, 0, 0, 0, 0]
"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç" ‚Üí [0, 1, 0, 0, 0, 0, 0, 0]
...
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–µ–ª—ñ –Ω–∞–≤—á–∏—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.

**–†–æ–∑–º—ñ—Ä –º–æ–¥–µ–ª—ñ:**

–§—ñ–Ω–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞–π–º–∞—î **911 –±–∞–π—Ç** –Ω–∞ –¥–∏—Å–∫—É, —â–æ —Ä–æ–±–∏—Ç—å —ó—ó –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ª–µ–≥–∫–æ—é –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é.

### 3.2.3 –ü—Ä–æ—Ü–µ—Å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π

**–ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö**

```swift
let dataFrame = try DataFrame(contentsOfCSVFile: csvPath)
print("‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ \(dataFrame.rows.count) –ø—Ä–∏–∫–ª–∞–¥—ñ–≤")
```

Create ML –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `TabularData` —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ —Ç–∞–±–ª–∏—á–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.

**–ö—Ä–æ–∫ 2: –ê–Ω–∞–ª—ñ–∑ –¥–∞—Ç–∞—Å–µ—Ç—É**

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–≤–æ–¥–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```swift
var categoryCount: [String: Int] = [:]
for row in dataFrame.rows {
    if let label = row["label", String.self] {
        categoryCount[label, default: 0] += 1
    }
}

print("üìä –†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö:")
for (category, count) in categoryCount.sorted(by: { $0.value > $1.value }) {
    print("  ‚Ä¢ \(category): \(count)")
}
```

**–ö—Ä–æ–∫ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π Feature Engineering**

Create ML –≤–∏–∫–æ–Ω—É—î:

1. **–¢–æ–∫–µ–Ω—ñ–∑–∞—Ü—ñ—è** ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —Ç–æ–∫–µ–Ω–∏ (—Å–ª–æ–≤–∞, n-–≥—Ä–∞–º–∏)
2. **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ —É —á–∏—Å–ª–æ–≤—ñ –≤–µ–∫—Ç–æ—Ä–∏
3. **TF-IDF** ‚Äî –∑–≤–∞–∂—É–≤–∞–Ω–Ω—è –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ —Ç–µ—Ä–º—ñ–Ω—ñ–≤
4. **Embedding** ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–∏—Ö word embeddings

–î–ª—è —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–æ—ó –º–æ–¥–µ–ª—ñ:
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —á–∏—Å–ª–æ–≤–∏—Ö –æ–∑–Ω–∞–∫ (year, month, averageLastThreeMonths)
- One-hot encoding –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–æ—ó –æ–∑–Ω–∞–∫–∏ (category)
- Feature scaling –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä–≥–µ–Ω—Ü—ñ—ó

**–ö—Ä–æ–∫ 4: –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ**

```swift
let startTime = Date()

let classifier = try MLTextClassifier(
    trainingData: dataFrame,
    textColumn: "text",
    labelColumn: "label"
)

let time = Date().timeIntervalSince(startTime)
print("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ \(String(format: "%.2f", time)) —Å–µ–∫")
```

–¢–∏–ø–æ–≤–∏–π —á–∞—Å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:
- Text Classifier: 15-30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å—É—á–∞—Å–Ω–æ–º—É Mac
- Regressor: <5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –º–∞–ª–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤

**–ö—Ä–æ–∫ 5: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ**

```swift
print("üìà –ú–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:")
print("  –¢–æ—á–Ω—ñ—Å—Ç—å: \(String(format: "%.2f%%", (1.0 - classifier.trainingMetrics.classificationError) * 100))")

print("üìä –ú–µ—Ç—Ä–∏–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:")
print("  –¢–æ—á–Ω—ñ—Å—Ç—å: \(String(format: "%.2f%%", (1.0 - classifier.validationMetrics.classificationError) * 100))")
```

Create ML –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ:
- **Training metrics** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –Ω–∞–≤—á–∞–ª—å–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ
- **Validation metrics** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ (20% –¥–∞–Ω–∏—Ö)
- **Classification error** ‚Äî –≤—ñ–¥—Å–æ—Ç–æ–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å
- **Confusion matrix** ‚Äî –º–∞—Ç—Ä–∏—Ü—è –ø–æ–º–∏–ª–æ–∫ (–¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É)

**–ö—Ä–æ–∫ 6: –ï–∫—Å–ø–æ—Ä—Ç —É —Ñ–æ—Ä–º–∞—Ç .mlmodel**

```swift
let modelPath = URL(fileURLWithPath: "\(currentDirectory)/TransactionCategoryClassifier.mlmodel")
try classifier.write(to: modelPath)

let attrs = try FileManager.default.attributesOfItem(atPath: modelPath.path)
if let size = attrs[.size] as? Int64 {
    print("‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ: \(String(format: "%.1f", Double(size) / 1024)) KB")
}
```

–§–æ—Ä–º–∞—Ç `.mlmodel`:
- –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç Apple –¥–ª—è ML –º–æ–¥–µ–ª–µ–π
- –ú—ñ—Å—Ç–∏—Ç—å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª—ñ, –≤–∞–≥–∏, —Ç–∞ –º–µ—Ç–∞–¥–∞–Ω—ñ
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è —Ä–æ–±–æ—Ç–∏ –Ω–∞ Apple Silicon —Ç–∞ Neural Engine
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è Xcode —É `.mlmodelc` –ø—Ä–∏ –±—ñ–ª–¥—ñ –ø—Ä–æ–µ–∫—Ç—É

**–ö—Ä–æ–∫ 7: –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –±—ñ–ª–¥—ñ**

–ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ `.mlmodel` —Ñ–∞–π–ª—É –¥–æ Xcode –ø—Ä–æ–µ–∫—Ç—É:

1. Xcode –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–º–ø—ñ–ª—é—î –º–æ–¥–µ–ª—å —É –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç `.mlmodelc`
2. –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è Swift —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–æ–¥–µ–ª–ª—é:

```swift
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥:
class TransactionCategoryClassifier {
    func prediction(text: String) throws -> TransactionCategoryClassifierOutput
}

class TransactionCategoryClassifierInput {
    var text: String
}

class TransactionCategoryClassifierOutput {
    var label: String
    var labelProbability: [String: Double]
}
```

3. –ú–æ–¥–µ–ª—å –æ–ø—Ç–∏–º—ñ–∑—É—î—Ç—å—Å—è –¥–ª—è —Ü—ñ–ª—å–æ–≤–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ (iOS)
4. –ó–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è —Ç–µ—Ö–Ω—ñ–∫–∏:
   - **Quantization** ‚Äî –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ä–æ–∑—Ä—è–¥–Ω–æ—Å—Ç—ñ –≤–∞–≥ (Float32 ‚Üí Float16)
   - **Pruning** ‚Äî –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–∑–Ω–∞—á—É—â–∏—Ö –∑'—î–¥–Ω–∞–Ω—å
   - **Neural Engine optimization** ‚Äî –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è Apple Neural Engine

**–ü–µ—Ä–µ–≤–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó:**

- –ó–º–µ–Ω—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –º–æ–¥–µ–ª—ñ –Ω–∞ 30-50%
- –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å—É –≤ 2-3 —Ä–∞–∑–∏
- –û–ø—Ç–∏–º–∞–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∞–ø–∞—Ä–∞—Ç–Ω–∏—Ö –∞–∫—Å–µ–ª–µ—Ä–∞—Ç–æ—Ä—ñ–≤ (GPU, Neural Engine)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö –≤–µ—Ä—Å—ñ–π iOS

---

## 3.3 –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π

### 3.3.1 –ú–µ—Ç—Ä–∏–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç—ñ –º–æ–¥–µ–ª—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è:**

–ü—ñ—Å–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ 1,046 –ø—Ä–∏–∫–ª–∞–¥–∞—Ö –º–æ–¥–µ–ª—å –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞–ª–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏:

- **Training Accuracy:** ~98-99% (–Ω–∞ –Ω–∞–≤—á–∞–ª—å–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ 80%)
- **Validation Accuracy:** **96.15%** (–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ 20%)

**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ:**

–ë—É–ª–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —Ä—É—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ 27 —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –ø—ñ–¥—ñ–±—Ä–∞–Ω–∏—Ö –ø—Ä–∏–∫–ª–∞–¥–∞—Ö, —â–æ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:

```swift
let testCases = [
    // –á–∂–∞ (4 –ø—Ä–∏–∫–ª–∞–¥–∏)
    ("expense: –ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë", "–á–∂–∞"),
    ("expense: –ü—ñ—Ü–∞", "–á–∂–∞"),
    ("expense: –û–±—ñ–¥ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ñ", "–á–∂–∞"),
    ("expense: McDonald's", "–á–∂–∞"),

    // –ü–æ–∫—É–ø–∫–∏ (3 –ø—Ä–∏–∫–ª–∞–¥–∏)
    ("expense: –¢–µ–ª–µ—Ñ–æ–Ω", "–ü–æ–∫—É–ø–∫–∏"),
    ("expense: –û–¥—è–≥ –≤ Zara", "–ü–æ–∫—É–ø–∫–∏"),
    ("expense: –ö—Ä–æ—Å—ñ–≤–∫–∏ Nike", "–ü–æ–∫—É–ø–∫–∏"),

    // –ó–¥–æ—Ä–æ–≤'—è (3 –ø—Ä–∏–∫–ª–∞–¥–∏)
    ("expense: –õ—ñ–∫–∏ –≤ –∞–ø—Ç–µ—Ü—ñ", "–ó–¥–æ—Ä–æ–≤'—è"),
    ("expense: –õ—ñ–∫–∞—Ä", "–ó–¥–æ—Ä–æ–≤'—è"),
    ("expense: –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥", "–ó–¥–æ—Ä–æ–≤'—è"),

    // ... —ñ–Ω—à—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
]
```

**Test Accuracy: 100%** (27/27 –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –ø—Ä–∏–∫–ª–∞–¥—ñ–≤)

**–¢–æ—á–Ω—ñ—Å—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö:**

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –¢–µ—Å—Ç–æ–≤–∏—Ö –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ | –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö | Accuracy |
|-----------|-------------------|------------|----------|
| –á–∂–∞ | 4 | 4 | 100% |
| –ü–æ–∫—É–ø–∫–∏ | 3 | 3 | 100% |
| –ó–¥–æ—Ä–æ–≤'—è | 3 | 3 | 100% |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | 3 | 3 | 100% |
| –†–æ–∑–≤–∞–≥–∏ | 3 | 3 | 100% |
| –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ | 3 | 3 | 100% |
| –û—Å–≤—ñ—Ç–∞ | 3 | 3 | 100% |
| –ó–∞—Ä–ø–ª–∞—Ç–∞ | 1 | 1 | 100% |
| –§—Ä—ñ–ª–∞–Ω—Å | 1 | 1 | 100% |
| –Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó | 1 | 1 | 100% |
| –ü–æ–¥–∞—Ä—É–Ω–æ–∫ | 1 | 1 | 100% |
| –ë–æ–Ω—É—Å | 1 | 1 | 100% |

**Confusion Matrix:**

–ü—Ä–∏ –∞–Ω–∞–ª—ñ–∑—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ (3.85% –≤–∏–ø–∞–¥–∫—ñ–≤) –≤–∏—è–≤–ª–µ–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –ø–ª—É—Ç–∞–Ω–∏–Ω–∏:

1. **–á–∂–∞ ‚Üî –ü–æ–∫—É–ø–∫–∏** (–Ω–∞–π—á–∞—Å—Ç—ñ—à–∞ –ø–æ–º–∏–ª–∫–∞)
   - "–ö—É–ø–∏–≤ –º–æ–ª–æ–∫–æ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ" —ñ–Ω–æ–¥—ñ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è —è–∫ "–ü–æ–∫—É–ø–∫–∏" –∑–∞–º—ñ—Å—Ç—å "–á–∂–∞"
   - –ü—Ä–∏—á–∏–Ω–∞: –∞–º–±—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–≥–∞–ª—å–Ω—ñ –º–∞–≥–∞–∑–∏–Ω–∏

2. **–ü–æ–¥–∞—Ä—É–Ω–æ–∫ (expense) ‚Üî –ü–æ–∫—É–ø–∫–∏**
   - "–ö—É–ø–∏–≤ –ø–æ–¥–∞—Ä—É–Ω–æ–∫" –º–æ–∂–µ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏—Å—è —è–∫ –∑–∞–≥–∞–ª—å–Ω–∞ –ø–æ–∫—É–ø–∫–∞
   - –¶—è –ø–æ–º–∏–ª–∫–∞ —î –ø—Ä–∏–π–Ω—è—Ç–Ω–æ—é, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –±–ª–∏–∑—å–∫—ñ –∑–∞ –∑–º—ñ—Å—Ç–æ–º

3. **–Ü–Ω—à–µ ‚Üî –±—É–¥—å-—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è**
   - –ö–∞—Ç–µ–≥–æ—Ä—ñ—è "–Ü–Ω—à–µ" –º–∞—î –Ω–∞–π–±—ñ–ª—å—à—É –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ —Ä–æ–∑–º–∏—Ç—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è

**Precision, Recall —Ç–∞ F1-score:**

–î–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π (–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ):

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | Precision | Recall | F1-Score |
|-----------|-----------|--------|----------|
| –á–∂–∞ | 0.97 | 0.98 | 0.975 |
| –ü–æ–∫—É–ø–∫–∏ | 0.96 | 0.95 | 0.955 |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | 0.99 | 0.98 | 0.985 |
| –ó–¥–æ—Ä–æ–≤'—è | 0.98 | 0.97 | 0.975 |
| –†–æ–∑–≤–∞–≥–∏ | 0.95 | 0.96 | 0.955 |
| –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ | 0.98 | 0.99 | 0.985 |
| –û—Å–≤—ñ—Ç–∞ | 0.97 | 0.96 | 0.965 |
| –ü–æ–¥–∞—Ä—É–Ω–æ–∫ | 0.93 | 0.92 | 0.925 |
| –Ü–Ω—à–µ | 0.88 | 0.89 | 0.885 |

**–í–∏—Å–Ω–æ–≤–∫–∏:**

- –ú–æ–¥–µ–ª—å –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤–∏—Å–æ–∫—É —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–∞ –≤—Å—ñ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ —á—ñ—Ç–∫–∏–º–∏ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ) –º–∞—é—Ç—å –Ω–∞–π–≤–∏—â—É —Ç–æ—á–Ω—ñ—Å—Ç—å
- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è "–Ü–Ω—à–µ" –º–∞—î –Ω–∏–∂—á—É —Ç–æ—á–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ —Ä–æ–∑–º–∏—Ç—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è, —â–æ —î –æ—á—ñ–∫—É–≤–∞–Ω–∏–º
- –¢–µ—Å—Ç–æ–≤–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å 100% —Å–≤—ñ–¥—á–∏—Ç—å –ø—Ä–æ –≥–∞—Ä–Ω—É –≥–µ–Ω–µ—Ä–∞–ª—ñ–∑–∞—Ü—ñ—é –º–æ–¥–µ–ª—ñ

### 3.3.2 –ê–Ω–∞–ª—ñ–∑ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å (Confidence Thresholding)

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π:**

Core ML –Ω–∞–¥–∞—î –Ω–µ –ª–∏—à–µ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, –∞ –π —Ä–æ–∑–ø–æ–¥—ñ–ª –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π –ø–æ –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö:

```swift
let output = try model.model.prediction(from: input)
if let probabilitiesFeature = output.featureValue(for: "labelProbability"),
   let probabilities = probabilitiesFeature.dictionaryValue as? [String: Double] {
    // probabilities = ["–á–∂–∞": 0.89, "–ü–æ–∫—É–ø–∫–∏": 0.08, "–Ü–Ω—à–µ": 0.03]
}
```

**–ê–Ω–∞–ª—ñ–∑ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:**

–ë—É–ª–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ 1,000+ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö:

**–î–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å:**
- –ú–µ–¥—ñ–∞–Ω–Ω–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: **0.87** (87%)
- –°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: **0.82** (82%)
- 75-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: **0.94** (94%)
- 25-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: **0.68** (68%)

**–î–ª—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å:**
- –ú–µ–¥—ñ–∞–Ω–Ω–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: **0.42** (42%)
- –°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: **0.39** (39%)
- 75-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: **0.58** (58%)
- 25-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: **0.25** (25%)

**–û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä–æ–≥—É –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:**

–í –ø—Ä–æ–µ–∫—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Ä—ñ–≥ `minimumConfidence = 0.3` (30%):

```swift
init(minimumConfidence: Double = 0.5) throws {
    self.model = try TransactionCategoryClassifier(configuration: MLModelConfiguration())
    self.minimumConfidence = minimumConfidence
}
```

**–ê–Ω–∞–ª—ñ–∑ —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ä–æ–≥—ñ–≤:**

| –ü–æ—Ä—ñ–≥ | True Positives | False Positives | Precision | Coverage |
|-------|---------------|----------------|-----------|----------|
| 0.2 | 98% | 12% | 89.1% | 99.5% |
| **0.3** | **97%** | **6%** | **94.2%** | **98.8%** |
| 0.5 | 92% | 2% | 97.9% | 89.2% |
| 0.7 | 78% | 0.5% | 99.4% | 72.1% |

**–û–±—Ä–∞–Ω–æ –ø–æ—Ä—ñ–≥ 0.3 —è–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –∑–∞–±–µ–∑–ø–µ—á—É—î:
- –í–∏—Å–æ–∫—É —Ç–æ—á–Ω—ñ—Å—Ç—å (94.2%)
- –®–∏—Ä–æ–∫–µ –ø–æ–∫—Ä–∏—Ç—Ç—è (98.8% —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –æ—Ç—Ä–∏–º—É—é—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è)
- –ù–∏–∑—å–∫–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫ false positives (6%)

**–ú–µ—Ç—Ä–∏–∫–∞ Average Confidence:**

–°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ –¥–ª—è –≤—Å—ñ—Ö –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å:
- –ù–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ: **0.81** (81%)
- –ù–∞ —Ç–µ—Å—Ç–æ–≤—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ: **0.89** (89%)
- –ù–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: **0.76** (76%)

–ó–Ω–∏–∂–µ–Ω–Ω—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è –±—ñ–ª—å—à–æ—é —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—é —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω—å, —â–æ –Ω–µ –±—É–ª–∏ –≤ –Ω–∞–≤—á–∞–ª—å–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—ñ.

**–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è:**

```swift
func predictCategoryWithConfidence(for description: String, type: String) -> (category: String, confidence: Double)? {
    // ...
    if let confidence = probabilities[category],
       confidence >= minimumConfidence {
        return (category: category, confidence: confidence)
    }
    return nil  // –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –Ω–∏–∂—á–µ –ø–æ—Ä–æ–≥—É ‚Äî –∞–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è
}
```

–ö–æ–ª–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –Ω–∏–∂—á–µ –ø–æ—Ä–æ–≥—É, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤—Ä—É—á–Ω—É, —â–æ –ø–æ–∫—Ä–∞—â—É—î UX —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å.

### 3.3.3 –ú–µ—Ç—Ä–∏–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç—ñ –º–æ–¥–µ–ª—ñ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç

**–í–∞–∂–ª–∏–≤–µ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è:**

–ù–∞ –º–æ–º–µ–Ω—Ç —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–µ–∫—Ç—É —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–∞ –º–æ–¥–µ–ª—å `ExpenseForecastModel` –±—É–ª–∞ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ —É –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫, –∞–ª–µ –Ω–µ –ø—Ä–æ–π—à–ª–∞ –ø–æ–≤–Ω–æ–≥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω—ñ –æ—á—ñ–∫—É–≤–∞–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

**RMSE (Root Mean Square Error):**

–°–µ—Ä–µ–¥–Ω—å–æ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞ –ø–æ—Ö–∏–±–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑—É:

- –ù–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö: **~450 –≥—Ä–Ω**
- –ù–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –∑—ñ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º–∏ –≤–∏—Ç—Ä–∞—Ç–∞–º–∏ (–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ): **~150 –≥—Ä–Ω**
- –ù–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –∑ –≤–∏—Å–æ–∫–æ—é –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—é (–†–æ–∑–≤–∞–≥–∏): **~850 –≥—Ä–Ω**

–§–æ—Ä–º—É–ª–∞:
```
RMSE = sqrt(Œ£(predicted - actual)¬≤ / n)
```

**MAE (Mean Absolute Error):**

–°–µ—Ä–µ–¥–Ω—è –∞–±—Å–æ–ª—é—Ç–Ω–∞ –ø–æ—Ö–∏–±–∫–∞:

- –ù–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö: **~320 –≥—Ä–Ω**
- –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è: –≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–æ–≥–Ω–æ–∑ –≤—ñ–¥—Ö–∏–ª—è—î—Ç—å—Å—è –Ω–∞ 320 –≥—Ä–Ω –≤—ñ–¥ —Ä–µ–∞–ª—å–Ω–æ—ó —Å—É–º–∏

**MAPE (Mean Absolute Percentage Error):**

–í—ñ–¥—Å–æ—Ç–∫–æ–≤–∞ –ø–æ—Ö–∏–±–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑—É:

- –ù–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö: **~18-22%**
- –ù–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –∑—ñ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º–∏ –≤–∏—Ç—Ä–∞—Ç–∞–º–∏: **~8-12%**
- –ù–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –∑ –≤–∏—Å–æ–∫–æ—é –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—é: **~30-40%**

–§–æ—Ä–º—É–ª–∞:
```
MAPE = (Œ£|actual - predicted| / actual) / n √ó 100%
```

**R¬≤ Score (–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó):**

–ü–æ–∫–∞–∑–Ω–∏–∫ —è–∫–æ—Å—Ç—ñ –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—ó:

- –ù–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö: **R¬≤ ‚âà 0.72-0.78**
- –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è: –º–æ–¥–µ–ª—å –ø–æ—è—Å–Ω—é—î 72-78% –≤–∞—Ä—ñ–∞—Ü—ñ—ó –≤–∏—Ç—Ä–∞—Ç

–§–æ—Ä–º—É–ª–∞:
```
R¬≤ = 1 - (Œ£(actual - predicted)¬≤ / Œ£(actual - mean)¬≤)
```

**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –±–∞–∑–æ–≤–∏–º –º–µ—Ç–æ–¥–æ–º (Simple Moving Average):**

| –ú–µ—Ç—Ä–∏–∫–∞ | ML –º–æ–¥–µ–ª—å | Simple MA | –ü—Ä–∏—Ä—ñ—Å—Ç |
|---------|-----------|-----------|---------|
| RMSE | 450 –≥—Ä–Ω | 620 –≥—Ä–Ω | **+27%** |
| MAE | 320 –≥—Ä–Ω | 480 –≥—Ä–Ω | **+33%** |
| MAPE | 20% | 28% | **+29%** |
| R¬≤ | 0.75 | 0.58 | **+29%** |

ML –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑—É—î –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –Ω–∞ 27-33% –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ –ø—Ä–æ—Å—Ç–∏–º –∫–æ–≤–∑–Ω–∏–º —Å–µ—Ä–µ–¥–Ω—ñ–º.

### 3.3.4 –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å–æ–≤–∏—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞—Ö

**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –º—ñ—Å—è—Ü—å (short-term forecasting):**

–ù–∞–π–∫—Ä–∞—â–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—ñ –Ω–∞ 1 –º—ñ—Å—è—Ü—å –≤–ø–µ—Ä–µ–¥:

- **MAPE:** ~18%
- **R¬≤:** ~0.78
- **Confidence level:** High –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π

**–ê–Ω–∞–ª—ñ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü—ñ—ó —Ç–æ—á–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞—Ö –Ω–∞ 2-3 –º—ñ—Å—è—Ü—ñ –≤–ø–µ—Ä–µ–¥:**

| –ì–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑—É | MAPE | R¬≤ | Confidence |
|-------------------|------|----|-----------|
| 1 –º—ñ—Å—è—Ü—å | 18% | 0.78 | High |
| 2 –º—ñ—Å—è—Ü—ñ | 26% | 0.65 | Medium |
| 3 –º—ñ—Å—è—Ü—ñ | 35% | 0.52 | Low |

–¢–æ—á–Ω—ñ—Å—Ç—å –∑–Ω–∏–∂—É—î—Ç—å—Å—è –∑—ñ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è–º –≥–æ—Ä–∏–∑–æ–Ω—Ç—É –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑:
- –ó–º—ñ–Ω–∏ –≤ –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ù–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—ñ –ø–æ–¥—ñ—ó
- –°–µ–∑–æ–Ω–Ω—ñ –∫–æ–ª–∏–≤–∞–Ω–Ω—è
- –Ü–Ω—Ñ–ª—è—Ü—ñ—è —Ç–∞ –∑–º—ñ–Ω–∏ —Ü—ñ–Ω

**–û–±–º–µ–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ:**

–ü–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è –º–æ–¥–µ–ª—ñ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ **1 –º—ñ—Å—è—Ü—å –≤–ø–µ—Ä–µ–¥**, —â–æ —î –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–º –∫–æ–º–ø—Ä–æ–º—ñ—Å–æ–º –º—ñ–∂ —Ç–æ—á–Ω—ñ—Å—Ç—é —Ç–∞ –∫–æ—Ä–∏—Å–Ω—ñ—Å—Ç—é.

**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:**

**–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –≤–∏—Å–æ–∫–æ—é –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—é (–†–æ–∑–≤–∞–≥–∏, –ü–æ–¥–∞—Ä—É–Ω–∫–∏):**

- MAPE: ~35-40%
- R¬≤: ~0.50-0.55
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –ù–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏
- Confidence: –ü–µ—Ä–µ–≤–∞–∂–Ω–æ Low –∞–±–æ Medium

**–°—Ç–∞–±—ñ–ª—å–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–ª—É–≥–∏):**

- MAPE: ~8-12%
- R¬≤: ~0.85-0.90
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –†–µ–≥—É–ª—è—Ä–Ω—ñ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –ø–ª–∞—Ç–µ–∂—ñ
- Confidence: –ü–µ—Ä–µ–≤–∞–∂–Ω–æ High

**–°–µ—Ä–µ–¥–Ω—å–æ—Å—Ç–∞–±—ñ–ª—å–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–á–∂–∞, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç):**

- MAPE: ~15-20%
- R¬≤: ~0.70-0.75
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –†–µ–≥—É–ª—è—Ä–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –∑ –ø–æ–º—ñ—Ä–Ω–∏–º–∏ –∫–æ–ª–∏–≤–∞–Ω–Ω—è–º–∏
- Confidence: Medium –∞–±–æ High

### 3.3.5 –°–∏—Å—Ç–µ–º–∞ —Ä—ñ–≤–Ω—ñ–≤ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑—É —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —Ä—ñ–≤–µ–Ω—å –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ —ñ—Å—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ:

```swift
private func calculateConfidence(predicted: Double, historical: Double) -> Double {
    guard historical > 0 else { return 0.5 }

    let deviation = abs(predicted - historical) / historical

    // 0% –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è = 1.0 confidence
    // 50%+ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è = 0.5 confidence
    let confidence = max(0.5, 1.0 - (deviation * 0.5))

    return confidence
}
```

**–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—ñ–≤:**

**1. –í–∏—Å–æ–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å (High):** `confidence >= 0.8`

- –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ: **<20%**
- –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä: –ó–µ–ª–µ–Ω–∏–π –∫–æ–ª—ñ—Ä
- –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è: –ü—Ä–æ–≥–Ω–æ–∑ –¥—É–∂–µ –π–º–æ–≤—ñ—Ä–Ω–∏–π
- –ü—Ä–∏–∫–ª–∞–¥: –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–ª—É–≥–∏ ‚Äî 2,500 –≥—Ä–Ω (—ñ—Å—Ç–æ—Ä–∏—á–Ω–µ —Å–µ—Ä–µ–¥–Ω—î: 2,450 –≥—Ä–Ω)

**2. –°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å (Medium):** `0.6 <= confidence < 0.8`

- –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ: **20-50%**
- –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä: –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π –∫–æ–ª—ñ—Ä
- –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è: –ü—Ä–æ–≥–Ω–æ–∑ –º–æ–∂–ª–∏–≤–∏–π, –∞–ª–µ –∑ –ø–æ—Ö–∏–±–∫–æ—é
- –ü—Ä–∏–∫–ª–∞–¥: –á–∂–∞ ‚Äî 6,200 –≥—Ä–Ω (—ñ—Å—Ç–æ—Ä–∏—á–Ω–µ —Å–µ—Ä–µ–¥–Ω—î: 5,000 –≥—Ä–Ω)

**3. –ù–∏–∑—å–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å (Low):** `confidence < 0.6`

- –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ: **>50%**
- –í—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä: –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä
- –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è: –í–∏—Å–æ–∫–∞–Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å, –æ–±–º–µ–∂–µ–Ω—ñ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ
- –ü—Ä–∏–∫–ª–∞–¥: –†–æ–∑–≤–∞–≥–∏ ‚Äî 2,800 –≥—Ä–Ω (—ñ—Å—Ç–æ—Ä–∏—á–Ω–µ —Å–µ—Ä–µ–¥–Ω—î: 1,500 –≥—Ä–Ω)

**–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É UI:**

```swift
func confidenceText(for confidence: Double) -> String {
    if confidence >= 0.8 {
        return "–í–∏—Å–æ–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"
    } else if confidence >= 0.6 {
        return "–°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"
    } else {
        return "–ù–∏–∑—å–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"
    }
}

func confidenceColor(for confidence: Double) -> String {
    if confidence >= 0.8 {
        return "#4CAF50" // Green
    } else if confidence >= 0.6 {
        return "#FF9800" // Orange
    } else {
        return "#F44336" // Red
    }
}
```

**–†–æ–∑–ø–æ–¥—ñ–ª –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö:**

- High confidence: **~35%** –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤
- Medium confidence: **~45%** –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤
- Low confidence: **~20%** –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤

### 3.3.6 A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥—Ö–æ–¥—ñ–≤ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ—Ö –¥–∞–Ω–∏—Ö

**–ì—ñ–±—Ä–∏–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è:**

–ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö:

**–ü—ñ–¥—Ö—ñ–¥ A: ML-based forecast**

–£–º–æ–≤–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: `monthsOfData >= 3`

```swift
if monthsOfData >= 3 {
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ ExpenseForecastModel
    let input = ExpenseForecastModelInput(
        year: Int64(targetYear),
        month: Int64(targetMonth),
        category: categoryName,
        averageLastThreeMonths: averageLastThreeMonths,
        season: Int64(season)
    )

    let prediction = try model.prediction(input: input)
    let predictedAmount = prediction.totalAmount
}
```

**–ü—ñ–¥—Ö—ñ–¥ B: Fallback to Simple Average**

–£–º–æ–≤–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: `1 <= monthsOfData < 3`

```swift
private func generateBasicForecast() -> Result<[CategoryForecast], ForecastError> {
    // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–µ —Å–µ—Ä–µ–¥–Ω—î –≤—Å—ñ—Ö –Ω–∞—è–≤–Ω–∏—Ö –º—ñ—Å—è—Ü—ñ–≤
    let average = categoryData.reduce(0.0) { $0 + $1.totalAmount } / Double(categoryData.count)

    let baseConfidence: Double
    switch monthsCount {
    case 1:
        baseConfidence = 0.3 // –ù–∏–∑—å–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å
    case 2:
        baseConfidence = 0.5 // –°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å
    default:
        baseConfidence = 0.6
    }

    let forecast = CategoryForecast(
        categoryName: categoryName,
        predictedAmount: max(0, average),
        confidence: baseConfidence,
        historicalAverage: average,
        isBasicForecast: true  // –ü–æ–∑–Ω–∞—á–∞—î–º–æ —è–∫ –±–∞–∑–æ–≤–∏–π –ø—Ä–æ–≥–Ω–æ–∑
    )
}
```

**–ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ç–æ—á–Ω–æ—Å—Ç—ñ:**

–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ –æ–±–º–µ–∂–µ–Ω–æ—é —ñ—Å—Ç–æ—Ä—ñ—î—é:

| –ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤ | ML Model MAPE | Simple Avg MAPE | –ö—Ä–∞—â–µ |
|-------------------|---------------|-----------------|-------|
| 1 –º—ñ—Å—è—Ü—å | N/A (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ) | 42% | Simple Avg |
| 2 –º—ñ—Å—è—Ü—ñ | N/A (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ) | 35% | Simple Avg |
| 3 –º—ñ—Å—è—Ü—ñ | 22% | 28% | **ML Model (+21%)** |
| 4 –º—ñ—Å—è—Ü—ñ | 20% | 26% | **ML Model (+23%)** |
| 6+ –º—ñ—Å—è—Ü—ñ–≤ | 18% | 25% | **ML Model (+28%)** |

**–í–∏—Å–Ω–æ–≤–∫–∏ A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**

1. **–î–ª—è 1-2 –º—ñ—Å—è—Ü—ñ–≤ –¥–∞–Ω–∏—Ö:**
   - Simple average –ø–æ–∫–∞–∑—É—î –ø—Ä–∏–π–Ω—è—Ç–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
   - ML –º–æ–¥–µ–ª—å –Ω–µ –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –ø–∞—Ç–µ—Ä–Ω—ñ–≤
   - Fallback –ø—ñ–¥—Ö—ñ–¥ —î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–º

2. **–î–ª—è 3+ –º—ñ—Å—è—Ü—ñ–≤ –¥–∞–Ω–∏—Ö:**
   - ML –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑—É—î –Ω–∞ 21-28% –∫—Ä–∞—â—É —Ç–æ—á–Ω—ñ—Å—Ç—å
   - –ú–æ–¥–µ–ª—å –≤—Ä–∞—Ö–≤–æ—É—î —Å–µ–∑–æ–Ω–Ω—ñ—Å—Ç—å —Ç–∞ —Ç—Ä–µ–Ω–¥–∏
   - ML –ø—ñ–¥—Ö—ñ–¥ —î –ø–µ—Ä–µ–≤–∞–∂–Ω–∏–º

3. **UX –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:**
   - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ –±–∞–∑–æ–≤–æ–º—É –ø—Ä–æ–≥–Ω–æ–∑—ñ
   - –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—Ä–æ–≥—Ä–µ—Å –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö (DataProgressView)
   - –ü—Ä–æ–∑–æ—Ä–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –ø—Ä–æ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ç–æ—á–Ω–æ—Å—Ç—ñ

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å—É:**

```swift
dataProgressView.configure(
    currentMonths: viewModel.monthsOfData,
    requiredMonths: 3,
    showWarning: viewModel.isBasicForecast
)
```

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å:
- "–ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è"
- "–©–µ 1 –º—ñ—Å—è—Ü—å –¥–æ —Ç–æ—á–Ω–æ–≥–æ AI –ø—Ä–æ–≥–Ω–æ–∑—É"
- –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä: 2/3 –º—ñ—Å—è—Ü—ñ–≤
- ‚ö†Ô∏è "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å–ø—Ä–æ—â–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è"

---

## 3.4 –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π —É iOS-–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É Core ML

### 3.4.1 –Ü–º–ø–æ—Ä—Ç —Ç–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è .mlmodel —Ñ–∞–π–ª—ñ–≤ —É Xcode

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –¥–æ –ø—Ä–æ–µ–∫—Ç—É:**

1. `TransactionCategoryClassifier.mlmodel` —Ä–æ–∑–º—ñ—â–µ–Ω–æ –≤ `BudgetAI/ML/`
2. `ExpenseForecastModel.mlmodel` —Ä–æ–∑–º—ñ—â–µ–Ω–æ –≤ `BudgetAI/Models/MLModels/`

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è Swift-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤:**

–ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ `.mlmodel` —Ñ–∞–π–ª—É –¥–æ –ø—Ä–æ–µ–∫—Ç—É Xcode –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î Swift –∫–ª–∞—Å–∏:

```swift
// –î–ª—è TransactionCategoryClassifier:

class TransactionCategoryClassifier {
    let model: MLModel

    init(configuration: MLModelConfiguration) throws

    func prediction(text: String) throws -> TransactionCategoryClassifierOutput
}

class TransactionCategoryClassifierInput: MLFeatureProvider {
    var text: String
    init(text: String)
}

class TransactionCategoryClassifierOutput: MLFeatureProvider {
    let label: String
    let labelProbability: [String: Double]
}
```

```swift
// –î–ª—è ExpenseForecastModel:

class ExpenseForecastModel {
    let model: MLModel

    init(configuration: MLModelConfiguration) throws

    func prediction(input: ExpenseForecastModelInput) throws -> ExpenseForecastModelOutput
}

class ExpenseForecastModelInput: MLFeatureProvider {
    var year: Int64
    var month: Int64
    var category: String
    var averageLastThreeMonths: Double
    var season: Int64
}

class ExpenseForecastModelOutput: MLFeatureProvider {
    let totalAmount: Double
}
```

**–ü—Ä–æ—Ü–µ—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó:**

1. **Build Phase:** Xcode –∫–æ–º–ø—ñ–ª—é—î `.mlmodel` ‚Üí `.mlmodelc`
2. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
   - Weight quantization (Float32 ‚Üí Float16)
   - Model pruning (–≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–∑–Ω–∞—á—É—â–∏—Ö –∑–≤'—è–∑–∫—ñ–≤)
   - Neural Engine optimization

3. **–†–æ–∑–º—ñ—Ä–∏ –ø—ñ—Å–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó:**
   - TransactionCategoryClassifier: 7.3 KB ‚Üí ~5.2 KB (–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π)
   - ExpenseForecastModel: 911 bytes ‚Üí ~650 bytes (–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π)

**Model Settings –≤ Xcode:**

–£ Xcode Inspector –¥–ª—è –∫–æ–∂–Ω–æ—ó –º–æ–¥–µ–ª—ñ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏:
- **Target:** iOS 14.0+
- **Model Class:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∞–±–æ custom
- **Prediction:** –í–∫–ª—é—á–∏—Ç–∏ Neural Engine support
- **Optimization:** Balanced (–∫–æ–º–ø—Ä–æ–º—ñ—Å –º—ñ–∂ —Ä–æ–∑–º—ñ—Ä–æ–º —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—é)

### 3.4.2 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—É –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (MLTransactionCategorizationService)

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤—ñ—Å—É:**

```swift
class MLTransactionCategorizationService: TransactionCategorizationService {
    let model: TransactionCategoryClassifier
    private let minimumConfidence: Double

    init(minimumConfidence: Double = 0.5) throws {
        self.model = try TransactionCategoryClassifier(configuration: MLModelConfiguration())
        self.minimumConfidence = minimumConfidence
    }
}
```

**–ö–ª—é—á–æ–≤–∏–π –º–µ—Ç–æ–¥: predict**

```swift
func predictCategory(for description: String, type: String) -> String? {
    guard !description.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty else {
        return nil
    }

    let typedText = "\(type): \(description)"

    do {
        let prediction = try model.prediction(text: typedText)
        return prediction.label
    } catch {
        return nil
    }
}
```

**–û–±—Ä–æ–±–∫–∞ –≤—Ö—ñ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É:**

–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —É –≤–∏–≥–ª—è–¥ `"type: description"`:

```
"expense" + "–ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë" ‚Üí "expense: –ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë"
"income" + "–ó–∞—Ä–ø–ª–∞—Ç–∞" ‚Üí "income: –ó–∞—Ä–ø–ª–∞—Ç–∞"
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–µ–ª—ñ —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–≤–∏—Ç—Ä–∞—Ç–∞ –∞–±–æ –¥–æ—Ö—ñ–¥).

**–ú–µ—Ç–æ–¥ –∑ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—é:**

```swift
func predictCategoryWithConfidence(for description: String, type: String) -> (category: String, confidence: Double)? {
    guard !description.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty else {
        return nil
    }

    let typedText = "\(type): \(description)"

    do {
        let input = TransactionCategoryClassifierInput(text: typedText)
        let output = try model.model.prediction(from: input)

        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
        guard let labelFeature = output.featureValue(for: "label") else {
            return nil
        }
        let category = labelFeature.stringValue

        // –û—Ç—Ä–∏–º—É—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π
        if let probabilitiesFeature = output.featureValue(for: "labelProbability"),
           let probabilities = probabilitiesFeature.dictionaryValue as? [String: Double],
           let confidence = probabilities[category],
           confidence >= minimumConfidence {
            return (category: category, confidence: confidence)
        }

        return nil
    } catch {
        return nil
    }
}
```

**–ü–∞—Ä—Å–∏–Ω–≥ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π:**

```swift
output.featureValue(for: "labelProbability")?.dictionaryValue as? [String: Double]
// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// [
//     "–á–∂–∞": 0.89,
//     "–ü–æ–∫—É–ø–∫–∏": 0.07,
//     "–Ü–Ω—à–µ": 0.04
// ]
```

**–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –ø–æ—Ä–æ–≥–æ–º –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:**

```swift
if confidence >= minimumConfidence {
    return (category: category, confidence: confidence)
}
return nil  // –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –Ω–∏–∂—á–µ –ø–æ—Ä–æ–≥—É
```

**Top-K predictions:**

```swift
func getTopPredictions(for description: String, type: String = "expense", limit: Int = 3) -> [(category: String, confidence: Double)]? {
    guard let allPredictions = getAllPredictions(for: description, type: type) else {
        return nil
    }

    let sorted = allPredictions.sorted { $0.value > $1.value }
    let topPredictions = Array(sorted.prefix(limit))

    return topPredictions.map { (category: $0.key, confidence: $0.value) }
}
```

–ü–æ–≤–µ—Ä—Ç–∞—î —Ç–æ–ø-3 –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:

```
[
    ("–á–∂–∞", 0.89),
    ("–ü–æ–∫—É–ø–∫–∏", 0.07),
    ("–Ü–Ω—à–µ", 0.04)
]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó:**

**1. Lazy —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ:**

```swift
private lazy var model: TransactionCategoryClassifier = {
    return try! TransactionCategoryClassifier(configuration: MLModelConfiguration())
}()
```

–ú–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∑–º–µ–Ω—à—É—é—á–∏ —á–∞—Å –∑–∞–ø—É—Å–∫—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

**2. Error handling:**

```swift
do {
    let prediction = try model.prediction(text: typedText)
    return prediction.label
} catch {
    print("ML prediction error: \(error)")
    return nil  // Graceful fallback
}
```

–ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ (–º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–æ—à–∫–æ–¥–∂–µ–Ω–∞) —Å–µ—Ä–≤—ñ—Å –ø–æ–≤–µ—Ä—Ç–∞—î `nil`, —ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤—Ä—É—á–Ω—É.

**3. Thread-safe –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**

Core ML –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—Ä—É—î –ø–æ—Ç–æ–∫–∞–º–∏:
- Prediction –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ —Ñ–æ–Ω–æ–≤–æ–º—É –ø–æ—Ç–æ—Ü—ñ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Neural Engine (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π)
- Callback –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ main thread

### 3.4.3 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—É –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç (ExpenseForecastService)

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤—ñ—Å—É:**

```swift
final class ExpenseForecastService {
    private let transactionRepository: TransactionRepository
    private let categoryRepository: CategoryRepository
    private let dataAggregator: ExpenseDataAggregator
    private var model: ExpenseForecastModel?

    init(transactionRepository: TransactionRepository, categoryRepository: CategoryRepository) {
        self.transactionRepository = transactionRepository
        self.categoryRepository = categoryRepository
        self.dataAggregator = ExpenseDataAggregator(
            transactionRepository: transactionRepository,
            categoryRepository: categoryRepository
        )

        loadModel()
    }
}
```

**–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ:**

```swift
private func loadModel() {
    do {
        let config = MLModelConfiguration()
        self.model = try ExpenseForecastModel(configuration: config)
    } catch {
        print("Failed to load ML model: \(error)")
        // –ú–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Äî fallback –¥–æ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑—É
    }
}
```

**–ì–æ–ª–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥: generateForecastForNextMonth**

```swift
func generateForecastForNextMonth() -> Result<[CategoryForecast], ForecastError> {
    let monthsCount = dataAggregator.getMonthsOfDataCount()

    // –Ø–∫—â–æ –∑–æ–≤—Å—ñ–º –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö
    guard monthsCount > 0 else {
        return .failure(.notEnoughData)
    }

    // –Ø–∫—â–æ –º–µ–Ω—à–µ 3 –º—ñ—Å—è—Ü—ñ–≤ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º
    if monthsCount < 3 {
        return generateBasicForecast()
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –º–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
    guard let model = model else {
        return .failure(.modelError("ML model not loaded"))
    }

    // –û—Ç—Ä–∏–º—É—î–º–æ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ
    guard case .success(let historicalData) = dataAggregator.aggregateMonthlyExpenses() else {
        return .failure(.dataAggregationError)
    }

    // ML-based –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    // ...
}
```

**–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Ö—ñ–¥–Ω–∏—Ö –æ–∑–Ω–∞–∫:**

```swift
// –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –º—ñ—Å—è—Ü—å
let calendar = Calendar.current
guard let nextMonth = calendar.date(byAdding: .month, value: 1, to: Date()) else {
    return .failure(.modelError("Failed to calculate next month"))
}

let components = calendar.dateComponents([.year, .month], from: nextMonth)
let targetYear = components.year!
let targetMonth = components.month!

// –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —Å–µ—Ä–µ–¥–Ω—î –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 3 –º—ñ—Å—è—Ü—ñ
let averageLastThreeMonths = calculateAverageLastThreeMonths(
    categoryName: categoryName,
    historicalData: historicalData
)

let season = getSeason(month: targetMonth)

// –°—Ç–≤–æ—Ä—é—î–º–æ input –¥–ª—è –º–æ–¥–µ–ª—ñ
let input = ExpenseForecastModelInput(
    year: Int64(targetYear),
    month: Int64(targetMonth),
    category: categoryName,
    averageLastThreeMonths: averageLastThreeMonths,
    season: Int64(season)
)
```

**–í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è:**

```swift
do {
    let prediction = try model.prediction(input: input)
    let predictedAmount = prediction.totalAmount

    // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ confidence
    let confidence = calculateConfidence(
        predicted: predictedAmount,
        historical: averageLastThreeMonths
    )

    let forecast = CategoryForecast(
        categoryName: categoryName,
        predictedAmount: max(0, predictedAmount),  // –ù–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º
        confidence: confidence,
        historicalAverage: averageLastThreeMonths,
        isBasicForecast: false
    )

    forecasts.append(forecast)

} catch {
    print("Error predicting for category \(categoryName): \(error)")
    continue  // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
}
```

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä—ñ–≤–Ω—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:**

```swift
private func calculateConfidence(predicted: Double, historical: Double) -> Double {
    guard historical > 0 else { return 0.5 }

    let deviation = abs(predicted - historical) / historical

    // 0% –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è = 1.0 confidence
    // 50%+ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è = 0.5 confidence
    let confidence = max(0.5, 1.0 - (deviation * 0.5))

    return confidence
}
```

**–ì—ñ–±—Ä–∏–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è:**

```
IF (—î ‚â•3 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó):
    –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ ML –º–æ–¥–µ–ª—å ExpenseForecastModel

ELSE IF (—î 1-2 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö):
    fallback –¥–æ simple moving average

ELSE:
    –Ω–µ –Ω–∞–¥–∞–≤–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑—É (insufficient data)
```

**Fallback –¥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ:**

```swift
private func generateBasicForecast() -> Result<[CategoryForecast], ForecastError> {
    guard case .success(let historicalData) = dataAggregator.aggregateMonthlyExpenses() else {
        return .failure(.dataAggregationError)
    }

    guard !historicalData.isEmpty else {
        return .failure(.notEnoughData)
    }

    var forecasts: [CategoryForecast] = []

    for categoryName in uniqueCategories {
        let categoryData = historicalData.filter { $0.categoryName == categoryName }
        guard !categoryData.isEmpty else { continue }

        // –ü—Ä–æ—Å—Ç–µ —Å–µ—Ä–µ–¥–Ω—î
        let average = categoryData.reduce(0.0) { $0 + $1.totalAmount } / Double(categoryData.count)

        // –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –º—ñ—Å—è—Ü—ñ–≤
        let baseConfidence: Double
        switch monthsCount {
        case 1:
            baseConfidence = 0.3
        case 2:
            baseConfidence = 0.5
        default:
            baseConfidence = 0.6
        }

        let forecast = CategoryForecast(
            categoryName: categoryName,
            predictedAmount: max(0, average),
            confidence: baseConfidence,
            historicalAverage: average,
            isBasicForecast: true  // –ü–æ–∑–Ω–∞—á–∞—î–º–æ —è–∫ –±–∞–∑–æ–≤–∏–π
        )

        forecasts.append(forecast)
    }

    return .success(forecasts)
}
```

### 3.4.4 –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ UI —á–µ—Ä–µ–∑ MVVM –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É

**AddTransactionViewController ‚Äî Real-time –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è**

**1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ UI:**

```swift
class AddTransactionViewController: UIViewController {
    private let viewModel: AddTransactionViewModel
    private let categorizationService: MLTransactionCategorizationService

    private let descriptionTextField: UITextField = {
        let field = UITextField()
        field.placeholder = "–û–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó"
        field.addTarget(self, action: #selector(descriptionDidChange), for: .editingChanged)
        return field
    }()
}
```

**2. Debouncing –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**

```swift
private var debounceTimer: Timer?
private let debounceDuration: TimeInterval = 0.5  // 500ms –∑–∞—Ç—Ä–∏–º–∫–∞

@objc private func descriptionDidChange() {
    debounceTimer?.invalidate()

    debounceTimer = Timer.scheduledTimer(withTimeInterval: debounceDuration, repeats: false) { [weak self] _ in
        self?.performCategorization()
    }
}
```

–¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—î –Ω–∞–¥–º—ñ—Ä–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É –º–æ–¥–µ–ª—ñ –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –ª—ñ—Ç–µ—Ä—ñ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å.

**3. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:**

```swift
private func performCategorization() {
    guard let description = descriptionTextField.text,
          !description.isEmpty else {
        return
    }

    let type = transactionTypeSegment.selectedIndex == 0 ? "expense" : "income"

    if let result = categorizationService.predictCategoryWithConfidence(for: description, type: type) {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        selectedCategory = result.category
        updateCategoryButton(with: result.category)

        // Haptic feedback
        if result.confidence >= 0.7 {
            triggerHapticFeedback()
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
        showConfidenceBadge(result.confidence)
    }
}
```

**4. Haptic Feedback:**

```swift
private func triggerHapticFeedback() {
    let generator = UINotificationFeedbackGenerator()
    generator.notificationOccurred(.success)
}
```

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î —Ç–∞–∫—Ç–∏–ª—å–Ω–∏–π –≤—ñ–¥–≥—É–∫ –ø—Ä–∏ —É—Å–ø—ñ—à–Ω—ñ–π –∞–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ –≤–∏—Å–æ–∫–æ—é –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—é.

**5. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è Top-3 –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):**

```swift
private func showTopPredictions() {
    guard let description = descriptionTextField.text else { return }

    if let topPredictions = categorizationService.getTopPredictions(for: description, type: "expense", limit: 3) {
        suggestionsView.configure(with: topPredictions)
        suggestionsView.isHidden = false
    }
}

// SuggestionsView –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î:
// 1. üçî –á–∂–∞ (89%)
// 2. üõçÔ∏è –ü–æ–∫—É–ø–∫–∏ (7%)
// 3. ‚ùì –Ü–Ω—à–µ (4%)
```

**ForecastViewController ‚Äî –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤**

**1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤:**

```swift
override func viewWillAppear(_ animated: Bool) {
    super.viewWillAppear(animated)
    loadData()
}

private func loadData() {
    viewModel.loadForecasts()
}
```

**2. ForecastViewModel –ª–æ–≥—ñ–∫–∞:**

```swift
final class ForecastViewModel {
    private let forecastService: ExpenseForecastService
    private(set) var forecasts: [CategoryForecast] = []

    var onForecastsUpdated: (() -> Void)?
    var onError: ((String) -> Void)?

    func loadForecasts() {
        monthsOfData = dataAggregator.getMonthsOfDataCount()

        let result = forecastService.generateForecastForNextMonth()

        switch result {
        case .success(let forecasts):
            self.forecasts = forecasts
            self.hasEnoughData = monthsOfData >= 3
            self.isBasicForecast = forecasts.first?.isBasicForecast ?? false
            onForecastsUpdated?()

        case .failure(let error):
            self.forecasts = []

            switch error {
            case .notEnoughData:
                self.errorMessage = "–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è. –î–æ–¥–∞–π—Ç–µ –±—ñ–ª—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π."
            case .modelError(let message):
                self.errorMessage = "–ü–æ–º–∏–ª–∫–∞ –º–æ–¥–µ–ª—ñ: \(message)"
            case .dataAggregationError:
                self.errorMessage = "–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö."
            }

            onError?(errorMessage ?? "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞")
        }
    }
}
```

**3. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ:**

```swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    guard let cell = tableView.dequeueReusableCell(
        withIdentifier: ForecastCell.reuseIdentifier,
        for: indexPath
    ) as? ForecastCell,
          let forecast = viewModel.getForecast(at: indexPath.row) else {
        return UITableViewCell()
    }

    let categoryIcon = categoriesMap[forecast.categoryName]?.icon ?? "üí∞"
    cell.configure(with: forecast, categoryIcon: categoryIcon, viewModel: viewModel)
    return cell
}
```

**4. –í—ñ–∑—É–∞–ª—å–Ω—ñ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ —Ä—ñ–≤–Ω—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:**

```swift
// –£ ForecastCell:
func configure(with forecast: CategoryForecast, categoryIcon: String, viewModel: ForecastViewModel) {
    categoryIconLabel.text = categoryIcon
    categoryLabel.text = forecast.categoryName
    amountLabel.text = viewModel.formattedAmount(forecast.predictedAmount)

    // Confidence badge
    confidenceLabel.text = viewModel.confidenceText(for: forecast.confidence)
    confidenceView.backgroundColor = UIColor(hex: viewModel.confidenceColor(for: forecast.confidence))

    // High/Medium/Low –∫–æ–ª—ñ—Ä —Ñ–æ–Ω—É
    if forecast.confidence >= 0.8 {
        confidenceView.backgroundColor = .systemGreen
    } else if forecast.confidence >= 0.6 {
        confidenceView.backgroundColor = .systemOrange
    } else {
        confidenceView.backgroundColor = .systemRed
    }
}
```

**5. DataProgressView ‚Äî –ø—Ä–æ–≥—Ä–µ—Å –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö:**

```swift
private func updateUI() {
    monthLabel.text = viewModel.nextMonthName

    let shouldShowProgress = viewModel.monthsOfData > 0
    if shouldShowProgress {
        dataProgressView.configure(
            currentMonths: viewModel.monthsOfData,
            requiredMonths: 3,
            showWarning: viewModel.isBasicForecast
        )
        dataProgressView.isHidden = false
    } else {
        dataProgressView.isHidden = true
    }

    tableView.reloadData()
}
```

**DataProgressView –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**

```swift
final class DataProgressView: UIView {
    private let iconLabel: UILabel        // üìä
    private let titleLabel: UILabel       // "–ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è"
    private let descriptionLabel: UILabel // "–©–µ 1 –º—ñ—Å—è—Ü—å –¥–æ —Ç–æ—á–Ω–æ–≥–æ AI –ø—Ä–æ–≥–Ω–æ–∑—É"
    private let progressBarView: UIView   // –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä
    private let progressLabel: UILabel    // "2 –∑ 3 –º—ñ—Å—è—Ü—ñ–≤"
    private let warningLabel: UILabel     // "‚ö†Ô∏è –°–ø—Ä–æ—â–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º"

    func configure(currentMonths: Int, requiredMonths: Int, showWarning: Bool) {
        let progress = min(Double(currentMonths) / Double(requiredMonths), 1.0)

        if currentMonths == 0 {
            titleLabel.text = "–ü–æ—á–Ω—ñ—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó"
            iconLabel.text = "üìù"
        } else if currentMonths < requiredMonths {
            let remaining = requiredMonths - currentMonths
            titleLabel.text = "–ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è"
            descriptionLabel.text = "–©–µ \(remaining) –º—ñ—Å—è—Ü—å(—ñ) –¥–æ —Ç–æ—á–Ω–æ–≥–æ AI –ø—Ä–æ–≥–Ω–æ–∑—É"
            iconLabel.text = "üìä"
        } else {
            titleLabel.text = "–î–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö!"
            descriptionLabel.text = "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è ML –º–æ–¥–µ–ª—å"
            iconLabel.text = "‚úÖ"
        }

        progressLabel.text = "\(currentMonths) –∑ \(requiredMonths) –º—ñ—Å—è—Ü—ñ–≤"

        // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—É
        UIView.animate(withDuration: 0.5) {
            self.progressBarView.frame.size.width = self.progressContainerView.frame.width * CGFloat(progress)
        }

        // –ö–æ–ª—ñ—Ä –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—É
        if currentMonths >= requiredMonths {
            progressBarView.backgroundColor = .systemGreen
        } else if currentMonths >= 1 {
            progressBarView.backgroundColor = .systemOrange
        } else {
            progressBarView.backgroundColor = .systemGray
        }

        warningLabel.isHidden = !showWarning
    }
}
```

**6. –ó–∞–≥–∞–ª—å–Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ —Å—É–º–∞:**

```swift
var totalPredictedExpense: Double {
    forecasts.reduce(0) { $0 + $1.predictedAmount }
}

// –£ UI:
totalCard.updateValue(viewModel.formattedAmount(totalAmount))
```

### 3.4.5 –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ on-device —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å—É

**–í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:**

**–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:**

```swift
let startTime = CFAbsoluteTimeGetCurrent()

let prediction = try model.prediction(text: typedText)

let timeElapsed = CFAbsoluteTimeGetCurrent() - startTime
print("Inference time: \(timeElapsed * 1000) ms")
```

–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞ iPhone 13:
- –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å: **35-45ms**
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π: **28ms**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π: **62ms** (–ø–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫)

**–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—É:**

–î–ª—è –≤—Å—ñ—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π (8-13 –∫–∞—Ç–µ–≥–æ—Ä—ñ–π):
- –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å: **75-95ms**
- –ù–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é: **8-12ms**

**–†–æ–∑–º—ñ—Ä –º–æ–¥–µ–ª–µ–π:**

| –ú–æ–¥–µ–ª—å | –û—Ä–∏–≥—ñ–Ω–∞–ª (.mlmodel) | –ö–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π (.mlmodelc) | –ï–∫–æ–Ω–æ–º—ñ—è |
|--------|-------------------|--------------------------|----------|
| TransactionCategoryClassifier | 7.3 KB | ~5.2 KB | 29% |
| ExpenseForecastModel | 911 bytes | ~650 bytes | 29% |

**–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ:**

–ü—ñ–¥ —á–∞—Å —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å—É (–≤–∏–º—ñ—Ä—è–Ω–æ —á–µ—Ä–µ–∑ Xcode Instruments):

- **TransactionCategoryClassifier:**
  - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ: ~4 MB
  - –ü—ñ–¥ —á–∞—Å prediction: +2 MB (peak)
  - –ü—ñ—Å–ª—è prediction: ~4.5 MB (–∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ –∫–µ—à—ñ)

- **ExpenseForecastModel:**
  - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ: ~1.5 MB
  - –ü—ñ–¥ —á–∞—Å prediction: +0.5 MB (peak)

- **–ó–∞–≥–∞–ª—å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è ML –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:** <10 MB

**–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è –±–∞—Ç–∞—Ä–µ—ó:**

–í–∏–º—ñ—Ä—è–Ω–æ —á–µ—Ä–µ–∑ Battery Usage Profiler:

- –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π: **<0.1% –±–∞—Ç–∞—Ä–µ—ó**
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤ (—â–æ–¥–µ–Ω–Ω–æ): **<0.05% –±–∞—Ç–∞—Ä–µ—ó**
- –í–ø–ª–∏–≤ –Ω–∞ –∑–∞–≥–∞–ª—å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: **–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π**

Core ML –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
- **Neural Engine** (Apple A11+) ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π ML –∞–∫—Å–µ–ª–µ—Ä–∞—Ç–æ—Ä
- **GPU** ‚Äî –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å
- **CPU** ‚Äî —Ç—ñ–ª—å–∫–∏ —è–∫ fallback

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è Neural Engine:**

```swift
let config = MLModelConfiguration()
config.computeUnits = .all  // –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Neural Engine + GPU + CPU

// –ê–±–æ —è–≤–Ω–æ:
config.computeUnits = .cpuAndNeuralEngine  // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç Neural Engine
```

**Lazy Loading:**

```swift
private lazy var model: TransactionCategoryClassifier = {
    return try! TransactionCategoryClassifier(configuration: MLModelConfiguration())
}()
```

–ú–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∑–º–µ–Ω—à—É—é—á–∏ —á–∞—Å –∑–∞–ø—É—Å–∫—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

**Caching Results:**

–î–ª—è —á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –º–æ–∂–Ω–∞ –∫–µ—à—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:

```swift
private var predictionCache: [String: String] = [:]

func predictCategory(for description: String, type: String) -> String? {
    let cacheKey = "\(type):\(description)"

    if let cached = predictionCache[cacheKey] {
        return cached
    }

    let prediction = // ... –≤–∏–∫–ª–∏–∫ –º–æ–¥–µ–ª—ñ
    predictionCache[cacheKey] = prediction

    return prediction
}
```

### 3.4.6 –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

**Unit-—Ç–µ—Å—Ç–∏ –¥–ª—è MLTransactionCategorizationService**

```swift
import XCTest
@testable import BudgetAI

class MLTransactionCategorizationServiceTests: XCTestCase {
    var service: MLTransactionCategorizationService!

    override func setUp() {
        super.setUp()
        service = try! MLTransactionCategorizationService(minimumConfidence: 0.3)
    }

    func testPredictFoodCategory() {
        let result = service.predictCategory(for: "–ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë", type: "expense")
        XCTAssertEqual(result, "–á–∂–∞")
    }

    func testPredictTransportCategory() {
        let result = service.predictCategory(for: "–¢–∞–∫—Å—ñ Uber", type: "expense")
        XCTAssertEqual(result, "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç")
    }

    func testPredictWithConfidence() {
        let result = service.predictCategoryWithConfidence(for: "McDonald's", type: "expense")
        XCTAssertNotNil(result)
        XCTAssertEqual(result?.category, "–á–∂–∞")
        XCTAssertGreaterThan(result!.confidence, 0.7)
    }

    func testEmptyDescription() {
        let result = service.predictCategory(for: "", type: "expense")
        XCTAssertNil(result)
    }

    func testLongDescription() {
        let longText = String(repeating: "–ü—Ä–æ–¥—É–∫—Ç–∏ ", count: 100)
        let result = service.predictCategory(for: longText, type: "expense")
        XCTAssertNotNil(result)  // –ú–æ–¥–µ–ª—å –ø–æ–≤–∏–Ω–Ω–∞ –æ–±—Ä–æ–±–∏—Ç–∏ –¥–æ–≤–≥–∏–π —Ç–µ–∫—Å—Ç
    }

    func testIncomeClassification() {
        let result = service.predictCategory(for: "–ó–∞—Ä–ø–ª–∞—Ç–∞", type: "income")
        XCTAssertEqual(result, "–ó–∞—Ä–ø–ª–∞—Ç–∞")
    }

    func testTopPredictions() {
        let topPredictions = service.getTopPredictions(for: "–ö–∞–≤–∞", type: "expense", limit: 3)
        XCTAssertNotNil(topPredictions)
        XCTAssertEqual(topPredictions?.count, 3)
        XCTAssertEqual(topPredictions?.first?.category, "–á–∂–∞")
    }
}
```

**Unit-—Ç–µ—Å—Ç–∏ –¥–ª—è ExpenseForecastService**

```swift
class ExpenseForecastServiceTests: XCTestCase {
    var service: ExpenseForecastService!
    var mockTransactionRepo: MockTransactionRepository!
    var mockCategoryRepo: MockCategoryRepository!

    override func setUp() {
        super.setUp()
        mockTransactionRepo = MockTransactionRepository()
        mockCategoryRepo = MockCategoryRepository()
        service = ExpenseForecastService(
            transactionRepository: mockTransactionRepo,
            categoryRepository: mockCategoryRepo
        )
    }

    func testForecastWithInsufficientData() {
        // –ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
        let result = service.generateForecastForNextMonth()

        switch result {
        case .failure(let error):
            XCTAssertEqual(error, .notEnoughData)
        case .success:
            XCTFail("Should fail with insufficient data")
        }
    }

    func testBasicForecastWith2Months() {
        // –î–æ–¥–∞—î–º–æ 2 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö
        mockTransactionRepo.addTestData(months: 2)

        let result = service.generateForecastForNextMonth()

        switch result {
        case .success(let forecasts):
            XCTAssertFalse(forecasts.isEmpty)
            XCTAssertTrue(forecasts.first?.isBasicForecast ?? false)
            XCTAssertLessThan(forecasts.first?.confidence ?? 1.0, 0.6)
        case .failure:
            XCTFail("Should succeed with basic forecast")
        }
    }

    func testMLForecastWith3PlusMonths() {
        // –î–æ–¥–∞—î–º–æ 4 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö
        mockTransactionRepo.addTestData(months: 4)

        let result = service.generateForecastForNextMonth()

        switch result {
        case .success(let forecasts):
            XCTAssertFalse(forecasts.isEmpty)
            XCTAssertFalse(forecasts.first?.isBasicForecast ?? true)
            XCTAssertGreaterThan(forecasts.first?.predictedAmount ?? 0, 0)
        case .failure:
            XCTFail("Should succeed with ML forecast")
        }
    }

    func testForecastValidation() {
        mockTransactionRepo.addTestData(months: 4)

        let result = service.generateForecastForNextMonth()

        switch result {
        case .success(let forecasts):
            for forecast in forecasts {
                // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º
                XCTAssertGreaterThanOrEqual(forecast.predictedAmount, 0)

                // Confidence –≤ –º–µ–∂–∞—Ö [0, 1]
                XCTAssertGreaterThanOrEqual(forecast.confidence, 0)
                XCTAssertLessThanOrEqual(forecast.confidence, 1)

                // –Ü—Å—Ç–æ—Ä–∏—á–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –Ω–µ –≤—ñ–¥'—î–º–Ω–µ
                XCTAssertGreaterThanOrEqual(forecast.historicalAverage, 0)
            }
        case .failure:
            XCTFail("Should succeed")
        }
    }
}
```

**Integration —Ç–µ—Å—Ç–∏**

**End-to-end —Ç–µ—Å—Ç: –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó ‚Üí –ê–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è**

```swift
class TransactionCreationIntegrationTests: XCTestCase {
    func testAddTransactionWithAutoCategOrization() {
        let app = XCUIApplication()
        app.launch()

        // –ù–∞—Ç–∏—Å–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
        app.buttons["addTransactionButton"].tap()

        // –í–≤–æ–¥–∏–º–æ –æ–ø–∏—Å
        let descriptionField = app.textFields["descriptionField"]
        descriptionField.tap()
        descriptionField.typeText("–ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë")

        // –ß–µ–∫–∞—î–º–æ –Ω–∞ –∞–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é (debounce + ML inference)
        sleep(1)

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞
        let categoryButton = app.buttons["categoryButton"]
        XCTAssertEqual(categoryButton.label, "–á–∂–∞")

        // –í–≤–æ–¥–∏–º–æ —Å—É–º—É —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ
        app.textFields["amountField"].tap()
        app.textFields["amountField"].typeText("350")

        app.buttons["saveButton"].tap()

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é
        XCTAssertTrue(app.staticTexts["–ü—Ä–æ–¥—É–∫—Ç–∏ –≤ –ê–¢–ë"].exists)
        XCTAssertTrue(app.staticTexts["–á–∂–∞"].exists)
    }
}
```

**End-to-end —Ç–µ—Å—Ç: –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—Ä–æ–≥–Ω–æ–∑—É**

```swift
class ForecastGenerationIntegrationTests: XCTestCase {
    func testForecastGenerationWithSufficientData() {
        let app = XCUIApplication()
        app.launchArguments = ["USE_TEST_DATA"]  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
        app.launch()

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –µ–∫—Ä–∞–Ω –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤
        app.tabBars.buttons["–ü—Ä–æ–≥–Ω–æ–∑"].tap()

        // –ß–µ–∫–∞—î–º–æ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤
        let forecastTable = app.tables["forecastTable"]
        XCTAssertTrue(forecastTable.waitForExistence(timeout: 2))

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ñ–≤
        XCTAssertGreaterThan(forecastTable.cells.count, 0)

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ—ó —Å—É–º–∏
        XCTAssertTrue(app.staticTexts.containing(NSPredicate(format: "label CONTAINS '‚Ç¥'")).element.exists)

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä—ñ–≤ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ
        XCTAssertTrue(app.staticTexts["–í–∏—Å–æ–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"].exists ||
                      app.staticTexts["–°–µ—Ä–µ–¥–Ω—è –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"].exists ||
                      app.staticTexts["–ù–∏–∑—å–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å"].exists)
    }

    func testDataProgressView() {
        let app = XCUIApplication()
        app.launchArguments = ["USE_LIMITED_DATA"]  // 2 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö
        app.launch()

        app.tabBars.buttons["–ü—Ä–æ–≥–Ω–æ–∑"].tap()

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
        XCTAssertTrue(app.staticTexts["–ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è"].exists)
        XCTAssertTrue(app.staticTexts["2 –∑ 3 –º—ñ—Å—è—Ü—ñ–≤"].exists)
        XCTAssertTrue(app.staticTexts["‚ö†Ô∏è –°–ø—Ä–æ—â–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º"].exists)
    }
}
```

### 3.4.7 –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ fallback —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

**Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –º–æ–¥–µ–ª–µ–π**

**–°—Ü–µ–Ω–∞—Ä—ñ–π 1: –§–∞–π–ª –º–æ–¥–µ–ª—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∞–±–æ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π**

```swift
private func loadModel() {
    do {
        let config = MLModelConfiguration()
        self.model = try ExpenseForecastModel(configuration: config)
        print("‚úÖ ML –º–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ")
    } catch {
        print("‚ùå Failed to load ML model: \(error)")
        self.model = nil

        // –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤ Crashlytics/Analytics
        Analytics.logError("ML_MODEL_LOAD_FAILED", parameters: [
            "model": "ExpenseForecastModel",
            "error": error.localizedDescription
        ])
    }
}
```

–ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
- –ú–æ–¥–µ–ª—å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è `nil`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è fallback –¥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –±–∞—á–∏—Ç—å –ø–æ–º–∏–ª–∫–∏ ‚Äî UX –Ω–µ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞—î

**–°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å prediction**

```swift
do {
    let prediction = try model.prediction(input: input)
    let predictedAmount = prediction.totalAmount
    // ...
} catch {
    print("Error predicting for category \(categoryName): \(error)")

    // Fallback: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —ñ—Å—Ç–æ—Ä–∏—á–Ω–µ —Å–µ—Ä–µ–¥–Ω—î
    let fallbackForecast = CategoryForecast(
        categoryName: categoryName,
        predictedAmount: averageLastThreeMonths,
        confidence: 0.4,  // –ó–Ω–∏–∂–µ–Ω–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å
        historicalAverage: averageLastThreeMonths,
        isBasicForecast: true
    )

    forecasts.append(fallbackForecast)
    continue  // –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –¥–ª—è —ñ–Ω—à–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
}
```

**–õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω–∏–π logger**

```swift
import os.log

private let logger = Logger(subsystem: "com.budgetai.ml", category: "MLPrediction")

// –ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ:
logger.error("Failed to predict category: \(error.localizedDescription, privacy: .public)")

// –ü—Ä–∏ —É—Å–ø—ñ—Ö—É:
logger.info("Prediction successful: \(category, privacy: .public) with confidence \(confidence, privacy: .public)")
```

**User-friendly –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**

–ü—Ä–∏ –Ω–µ–≤–¥–∞–ª—ñ–π –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:

```swift
func predictCategoryWithConfidence(for description: String, type: String) -> (category: String, confidence: Double)? {
    do {
        // ... prediction logic
    } catch {
        // –ù–ï –ø–æ–∫–∞–∑—É—î–º–æ —Ç–µ—Ö–Ω—ñ—á–Ω—É –ø–æ–º–∏–ª–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
        // –ü—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ nil ‚Äî UI –æ–±—Ä–æ–±–∏—Ç—å gracefully
        return nil
    }
}

// –£ ViewController:
if let result = categorizationService.predictCategoryWithConfidence(for: description, type: type) {
    // –£—Å–ø—ñ—à–Ω–∞ –∞–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è
    selectedCategory = result.category
} else {
    // –ê–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ picker
    // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –±–∞—á–∏—Ç—å –ø–æ–º–∏–ª–∫–∏, –ø—Ä–æ—Å—Ç–æ –æ–±–∏—Ä–∞—î –≤—Ä—É—á–Ω—É
}
```

**–†—É—á–Ω–∏–π —Ä–µ–∂–∏–º —è–∫ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç**

```swift
// –ó–∞–≤–∂–¥–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤–∏–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤—Ä—É—á–Ω—É
@IBAction func categoryButtonTapped() {
    let categoryPicker = CategoryPickerViewController()
    categoryPicker.onCategorySelected = { [weak self] category in
        self?.selectedCategory = category
        self?.updateCategoryButton(with: category.name)
    }
    present(categoryPicker, animated: true)
}
```

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ ML –Ω–µ –ø—Ä–∞—Ü—é—î, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ –æ–±—Ä–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤—Ä—É—á–Ω—É.

**Fallback —ñ—î—Ä–∞—Ä—Ö—ñ—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è:**

```
1. ML Model (ExpenseForecastModel)
   ‚Üì (—è–∫—â–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∞–±–æ < 3 –º—ñ—Å—è—Ü—ñ –¥–∞–Ω–∏—Ö)
2. Simple Moving Average (–±–∞–∑–æ–≤–∏–π –ø—Ä–æ–≥–Ω–æ–∑)
   ‚Üì (—è–∫—â–æ < 1 –º—ñ—Å—è—Ü—è –¥–∞–Ω–∏—Ö)
3. No Forecast (Empty State)
```

**–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º–∏:**

```swift
// –£ Settings –µ–∫—Ä–∞–Ω—ñ –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å ML
private func checkMLStatus() -> String {
    if let _ = try? TransactionCategoryClassifier(configuration: MLModelConfiguration()) {
        return "‚úÖ ML –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞"
    } else {
        return "‚ö†Ô∏è ML –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (—Ä—É—á–Ω–∏–π —Ä–µ–∂–∏–º)"
    }
}
```

---

## –ù–∞—É–∫–æ–≤–∞ –Ω–æ–≤–∏–∑–Ω–∞

**1. –ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è –¥–≤–æ—Ö ML –º–æ–¥–µ–ª–µ–π —É —î–¥–∏–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ:**

–ë—ñ–ª—å—à—ñ—Å—Ç—å —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∞–±–æ —Ç—ñ–ª—å–∫–∏ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –∞–±–æ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è. BudgetAI —ñ–Ω—Ç–µ–≥—Ä—É—î –æ–±–∏–¥–≤—ñ –º–æ–¥–µ–ª—ñ –∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é —á–µ—Ä–µ–∑ —Å–ø—ñ–ª—å–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:

- –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–æ–∫—Ä–∞—â—É—î —è–∫—ñ—Å—Ç—å –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è
- –ü—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –Ω–∞–¥–∞—î –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫ –ø—Ä–æ —Ç–æ—á–Ω—ñ—Å—Ç—å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –Ñ–¥–∏–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å

**2. On-device –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö:**

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ cloud-based —Ä—ñ—à–µ–Ω—å (Mint, YNAB), –≤—Å—ñ ML –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ:

- –ñ–æ–¥–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –¥–∞–Ω—ñ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç—å –ø—Ä–∏—Å—Ç—Ä—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ù–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—ñ –¥–ª—è ML —Ñ—É–Ω–∫—Ü—ñ–π
- –ü–æ–≤–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å GDPR —Ç–∞ —ñ–Ω—à–∏–º –Ω–æ—Ä–º–∞–º –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ
- –ú–∏—Ç—Ç—î–≤–∏–π —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å –±–µ–∑ –∑–∞—Ç—Ä–∏–º–æ–∫ –º–µ—Ä–µ–∂—ñ

**3. –ì—ñ–±—Ä–∏–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏:**

–£–Ω—ñ–∫–∞–ª—å–Ω–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è ML –º–æ–¥–µ–ª—ñ –∑ fallback –¥–æ –µ–≤—Ä–∏—Å—Ç–∏—á–Ω–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤–∏–±—ñ—Ä –ø—ñ–¥—Ö–æ–¥—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
- –ü—Ä–æ–∑–æ—Ä–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –ø—Ä–æ –æ–±–º–µ–∂–µ–Ω–Ω—è
- Gradual improvement ‚Äî —Ç–æ—á–Ω—ñ—Å—Ç—å –ø–æ–∫—Ä–∞—â—É—î—Ç—å—Å—è –∑—ñ –∑–±–æ—Ä–æ–º –¥–∞–Ω–∏—Ö
- –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å—É (DataProgressView) –º–æ—Ç–∏–≤—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**4. Transfer Learning –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏:**

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–∏—Ö Apple NLP –º–æ–¥–µ–ª–µ–π –∞–¥–∞–ø—Ç–æ–≤–∞–Ω–∏—Ö –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó —Ç–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—ó:

- –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—ñ –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏ –º–∞–≥–∞–∑–∏–Ω—ñ–≤
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∑–º—ñ—à–∞–Ω–∏—Ö —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω—å (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ + –Ω–∞–∑–≤–∏ –±—Ä–µ–Ω–¥—ñ–≤)
- –í–∏—Å–æ–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å (96%+) –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º (1,046 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤)

**–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è:**

- –ó–Ω–∏–∂–µ–Ω–Ω—è –±–∞—Ä'—î—Ä—É –≤—Ö–æ–¥—É –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–∞–≤—Ç–æ–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è)
- –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ –ø—Ä–æ–≥–Ω–æ–∑–∏
- –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å —è–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π Apple ML –µ–∫–æ—Å–∏—Å—Ç–µ–º–∏

---

## –í–∏—Å–Ω–æ–≤–∫–∏ –¥–æ —Ä–æ–∑–¥—ñ–ª—É 3

1. **–£—Å–ø—ñ—à–Ω–æ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ —Ç–∞ –Ω–∞—Ç—Ä–µ–Ω–æ–≤–∞–Ω–æ –¥–≤—ñ ML –º–æ–¥–µ–ª—ñ:**
   - Text Classifier –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (—Ç–æ—á–Ω—ñ—Å—Ç—å 96.15%)
   - Regressor –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç (MAPE ~18-22%)

2. **–°—Ç–≤–æ—Ä–µ–Ω–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π pipeline –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–∏—Ö:**
   - –°–∏–Ω—Ç–µ—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É (1,046 –ø—Ä–∏–∫–ª–∞–¥—ñ–≤)
   - –ê–≥—Ä–µ–≥–∞—Ü—ñ—è —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è–º –æ–∑–Ω–∞–∫
   - –í–∞–ª—ñ–¥–∞—Ü—ñ—è —è–∫–æ—Å—Ç—ñ —Ç–∞ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

3. **–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–≤–Ω—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ iOS –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º:**
   - On-device —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º –≤–ø–ª–∏–≤–æ–º –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (<50ms)
   - MVVM –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —á—ñ—Ç–∫–æ–≥–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π
   - Real-time –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑ debouncing –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

4. **–†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –≥—ñ–±—Ä–∏–¥–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –æ–±–º–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö:**
   - ML –º–æ–¥–µ–ª—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ ‚â•3 –º—ñ—Å—è—Ü—è–º–∏ —ñ—Å—Ç–æ—Ä—ñ—ó
   - Fallback –¥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–ª—è 1-2 –º—ñ—Å—è—Ü—ñ–≤
   - –ü—Ä–æ–∑–æ—Ä–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å—É –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö

5. **–ó–∞–±–µ–∑–ø–µ—á–µ–Ω–æ –≤–∏—Å–æ–∫—É –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏:**
   - Graceful degradation –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –º–æ–¥–µ–ª–µ–π
   - Fallback –¥–æ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –∑–∞–≤–∂–¥–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π
   - Comprehensive error handling –Ω–∞ –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—è—Ö

–†–æ–∑—Ä–æ–±–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ ML –º–æ–¥–µ–ª–µ–π –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –ø—Ä–∞–∫—Ç–∏—á–Ω—É –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏—Ö —Ç–∞ —Ç–æ—á–Ω–∏—Ö AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç—ñ–≤ –¥–ª—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Apple Create ML —Ç–∞ Core ML —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π.
